<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LPFHRA - Member Registration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
    margin: 0;
    padding: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #0D1B2A, #1B263B, #415A77);
    background-repeat: no-repeat;
    background-attachment: fixed;
    background-size: cover;
    color: #ffffff;
    min-height: 100vh;
    line-height: 1.6;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    box-sizing: border-box;
}


#preloader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(13, 27, 42, 0.9); 
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    flex-direction: column;
    color: #ffffff;
    opacity: 1;
    visibility: visible;
    transition: opacity 0.5s ease, visibility 0.5s ease;
}

#preloader.hidden {
    opacity: 0;
    visibility: hidden;
}

.preloader-content {
    text-align: center;
}

.preloader-content img {
    width: 100px;
    height: 100px;
    animation: pulse 2s infinite;
    border-radius: 50%;
    box-shadow: 0 0 25px rgba(255, 255, 255, 0.25), 
                0 0 50px rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    background: rgba(255, 255, 255, 0.05);
    padding: 5px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.spinner {
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid #ffffff;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.preloader-content p {
    font-size: 1.2em;
    font-weight: 500;
}


@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

header {
    text-align: center;
    margin-bottom: 30px;
}

.logo {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    margin-bottom: 15px;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
}

header h1 {
    font-size: 2.2em;
    margin-bottom: 10px;
    color: #E0FBFC;
}

header p {
    font-size: 1.1em;
    color: #BDD2F0;
}


form {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.form-section {
    background: rgba(255, 255, 255, 0.08);
    padding: 25px;
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.15);
}

.form-section h2 {
    font-size: 1.6em;
    margin-bottom: 20px;
    color: #E0FBFC;
    border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    padding-bottom: 10px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #BDD2F0;
}

.form-group input[type="text"],
.form-group input[type="email"],
.form-group input[type="tel"],
.form-group input[type="password"],
.form-group select {    
    width: 100%; 
    padding: 12px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.1);
    color: #ffffff;
    font-size: 1em;
    transition: border-color 0.3s ease, background-color 0.3s ease;
    box-sizing: border-box;
}

.form-group input::placeholder,
.form-group select option {
    color: #cccccc;
}

.form-group input:focus,
.form-group select:focus {
    border-color: #72E0A4;
    background: rgba(255, 255, 255, 0.15);
    outline: none;
    box-shadow: 0 0 8px rgba(114, 224, 164, 0.4);
}

.form-group select {
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22%23ffffff%22%3E%3Cpath%20d%3D%22M7%2010l5%205%205-5z%22%2F%3E%3C%2Fsvg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 20px;
    cursor: pointer;
}

.password-wrapper {
    position: relative;
}

.password-wrapper input {
    padding-right: 45px;
}

.password-wrapper .toggle-password {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #BDD2F0;
    font-size: 0.9em;
}


.profile-upload-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
    text-align: center;
}

.profile-pic-wrapper {
    position: relative;
    width: 150px;
    height: 150px;
    border-radius: 50%;
    overflow: hidden;
    border: 3px solid #72E0A4;
    box-shadow: 0 0 15px rgba(114, 224, 164, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 10px; 
}

.profile-pic-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}


.upload-btn {
    background: #72E0A4;
    color: #0D1B2A;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600;
    transition: background-color 0.3s ease, transform 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center; 
    gap: 8px;
    width: fit-content; 
    margin: 0 auto; 
}

.upload-btn:hover {
    background: #60c995;
    transform: translateY(-2px);
}

.upload-btn i {
    font-size: 1.2em; 
}

.file-upload-wrapper {
    display: flex;
    flex-direction: column; 
    align-items: center; 
    gap: 15px;
    flex-wrap: wrap;
    margin-top: 10px; 
}

.file-upload-wrapper img {
    max-width: 150px;
    max-height: 150px;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    object-fit: cover;
    margin-top: 10px; 
}

.file-status {
    margin-top: 5px;
    font-size: 0.9em;
    color: #BDD2F0;
    display: flex;
    align-items: center;
    gap: 5px;
}

.file-status .fa-check-circle {
    color: #72E0A4;
}

.file-status .fa-times-circle {
    color: #FF6B6B;
}


.submit-btn {
    background: #4CAF50; 
    color: white;
    padding: 15px 25px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: 600;
    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    margin-top: 20px;
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
}

.submit-btn:hover {
    background: #45a049;
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(76, 175, 80, 0.6);
}

.submit-btn:disabled {
    background: #cccccc;
    cursor: not-allowed;
    box-shadow: none;
}


.login-prompt {
    text-align: center;
    margin-top: 20px;
    color: #BDD2F0;
    font-size: 0.95em;
}

.login-prompt a {
    color: #72E0A4;
    text-decoration: none;
    font-weight: 600;
    transition: color 0.3s ease;
}

.login-prompt a:hover {
    color: #60c995;
    text-decoration: underline;
}


#notificationContainer {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.notification {
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 15px 20px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    animation: slideInRight 0.5s forwards;
    display: flex;
    align-items: center;
    gap: 15px;
    max-width: 350px;
}

.notification.success {
    border-left: 5px solid #4CAF50;
}

.notification.error {
    border-left: 5px solid #FF6B6B;
}

.notification.info {
    border-left: 5px solid #2196F3;
}

.notification .icon {
    font-size: 1.5em;
}

.notification .message {
    flex-grow: 1;
}

.notification .close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 1.2em;
    cursor: pointer;
    transition: color 0.3s ease;
}

.notification .close-btn:hover {
    color: #ccc;
}

@keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}


@media (max-width: 8px) {
    .container {
        padding: 25px;
        margin: 15px;
    }

    header h1 {
        font-size: 1.0em;
    }

    .form-section h2 {
        font-size: 1.0em;
    }

    
    .form-group input,
    .form-group select {
        width: 100%; 
        padding: 10px;
    }

    .upload-btn {
        width: 100%;
        justify-content: center;
    }
}

@media (max-width: 480px) {
    body {
        padding: 10px;
    }

    .container {
        padding: 20px;
    }

    header h1 {
        font-size: 1.0em;
    }

    .form-section h2 {
        font-size: 1.0em;
    }
}
    </style>
</head>
<body>
    <div id="preloader">
        <div class="preloader-content">
            <img src="https://i.imgur.com/lwddsvh.png" alt="Loading Logo" />
            <div class="spinner"></div>
            <p>Peace is loading…</p>
        </div>
    </div>

    <div class="container">
        <header>
            <img src="https://i.imgur.com/lwddsvh.png" alt="LPFHRA Logo" class="logo">
            <h1>LPFHRA Member Registration</h1>
            <p>Join us in promoting peace and human rights.</p>
        </header>

        <form id="registrationForm">
            <div class="form-section">
                <h2>Personal Information & Verification</h2>
                <div class="profile-upload-section">
                    <div class="profile-pic-wrapper">
                        <img id="profilePreview" src="https://via.placeholder.com/150?text=Profile+Photo" alt="Profile Photo">
                        <input type="file" id="profilePhotoUpload" accept="image/*" style="display: none;">
                        <button type="button" id="profileUploadBtn" class="upload-btn"><i class="fas fa-camera-retro"></i> Upload/Capture Photo</button>
                        <p class="file-status" id="profileStatus"></p>
                    </div>
                    <small>Please upload a clear photo of your face for verification (can be captured or chosen).</small>
                </div>

                <div class="form-group" id="lpfhraIdSection">
                    <label for="lpfhraIdUpload">Upload LPFHRA ID Card:</label>
                    <div class="file-upload-wrapper">
                        <input type="file" id="lpfhraIdUpload" accept="image/*" style="display: none;" required>
                        <button type="button" class="upload-btn" id="lpfhraIdUploadBtn"><i class="fas fa-user-check"></i> Upload/Capture LPFHRA ID</button>
                        <img id="lpfhraIdPreview" src="" alt="LPFHRA ID Card Preview" style="display: none;">
                        <p class="file-status" id="lpfhraIdStatus"></p>
                    </div>
                    <input type="text" id="lpfhraIdNumber" placeholder="Enter LPFHRA ID Number" required>
                    <small>This is your official LPFHRA identification.</small>
                </div>

                <div class="form-group">
                    <label for="idCardType">Official ID Card & Address Verification:</label>
                    <select id="idCardType" required>
                        <option value="">Select ID Type & Verification...</option>
                        <option value="nin">National Identification Number (NIN) Card + Utility Bill/Hospital Card</option>
                        <option value="voter">Voter's Card + Utility Bill/Hospital Card</option>
                    </select>
                </div>
                
                <div class="form-group" id="ninVoterUtilitySection" style="display: none;">
                    <label for="ninVoterUpload">Upload NIN/Voter's Card:</label>
                    <div class="file-upload-wrapper">
                        <input type="file" id="ninVoterUpload" accept="image/*" style="display: none;">
                        <button type="button" class="upload-btn" id="ninVoterUploadBtn"><i class="fas fa-id-card"></i> Upload/Capture ID Card</button>
                        <img id="ninVoterPreview" src="" alt="NIN/Voter's Card Preview" style="display: none;">
                        <p class="file-status" id="ninVoterStatus"></p>
                    </div>
                    <input type="text" id="ninVoterNumber" placeholder="Enter ID Card Number" required>

                    <label for="utilityBillUpload" style="margin-top: 20px;">Upload Utility Bill or Hospital Card:</label>
                    <div class="file-upload-wrapper">
                        <input type="file" id="utilityBillUpload" accept="image/*" style="display: none;">
                        <button type="button" class="upload-btn" id="utilityBillUploadBtn"><i class="fas fa-file-invoice"></i> Upload/Capture Document</button>
                        <img id="utilityBillPreview" src="" alt="Utility Bill/Hospital Card Preview" style="display: none;">
                        <p class="file-status" id="utilityBillStatus"></p>
                    </div>
                    <small>This helps in verifying your address or health status.</small>
                </div>
            </div>

            <div class="form-section">
                <h2>Membership Details</h2>
                <div class="form-group">
                    <label for="fullName">Full Name:</label>
                    <input type="text" id="fullName" placeholder="Enter your full name" required>
                </div>
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" placeholder="Enter your email address" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number:</label>
                    <input type="tel" id="phone" placeholder="e.g., +2348012345678" required>
                </div>
                <div class="form-group">
                    <label for="gender">Gender:</label>
                    <select id="gender" required>
                        <option value="">Select Gender...</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="functionId">Member ID:</label>
                    <input type="text" id="functionId" placeholder="Enter your Member ID" required>
                </div>

                <div class="form-group">
                    <label for="position">Member Position:</label>
                    <select id="position">
                        <option value="">Select Position...</option>
                        <option value="other">Other (Specify below)</option>
                    </select>
                    <input type="text" id="otherPosition" placeholder="Enter your position" style="display: none; margin-top: 10px;">
                </div>

                <div class="form-group">
                    <label for="country">Country:</label>
                    <select id="country" required>
                        <option value="">Select Country...</option>
                    </select>
                </div>

                <div class="form-group" id="otherLocationSection" style="display: none;">
                    <label for="otherState">State/Province:</label>
                    <input type="text" id="otherState" placeholder="Enter your State/Province">
                    <label for="otherLGA" style="margin-top: 15px;">City/Region:</label>
                    <input type="text" id="otherLGA" placeholder="Enter your City/Region">
                </div>

                <div class="form-group" id="stateLGASection" style="display: none;">
                    <label for="state">State:</label>
                    <select id="state">
                        <option value="">Select State...</option>
                    </select>
                </div>
                <div class="form-group" id="lgaSection" style="display: none;">
                    <label for="lga">Local Government Area:</label>
                    <select id="lga" disabled>
                        <option value="">Select LGA...</option>
                    </select>
                </div>
            </div>

            <div class="form-section">
                <h2>Account Security</h2>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <div class="password-wrapper">
                        <input type="password" id="password" placeholder="Enter your password" required>
                        <i class="fas fa-eye toggle-password"></i>
                    </div>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password:</label>
                    <div class="password-wrapper">
                        <input type="password" id="confirmPassword" placeholder="Confirm your password" required>
                        <i class="fas fa-eye toggle-password"></i>
                    </div>
                </di>
            </div>
            
            <button type="submit" class="submit-btn">Register</button>
            <p class="login-prompt">Already a register? <a href="login.html">Login here</a></p>
        </form>
    </div>

    <div id="notificationContainer"></div>
    
    

  <script type="module">
         import { app } from './firebase.js'; 
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";


const db = getDatabase(app);
const auth = getAuth(app);

let profilePhotoLink = '';
let lpfhraIdCardLink = '';
let ninVoterCardLink = '';
let utilityBillLink = '';

document.addEventListener('DOMContentLoaded', () => {
    const preloader = document.getElementById('preloader');
    const registrationForm = document.getElementById('registrationForm');
    
 
    const profilePhotoUpload = document.getElementById('profilePhotoUpload');
    const profilePreview = document.getElementById('profilePreview');
    const profileUploadBtn = document.getElementById('profileUploadBtn');
    const profileStatus = document.getElementById('profileStatus');

   
    const lpfhraIdSection = document.getElementById('lpfhraIdSection');
    const lpfhraIdUpload = document.getElementById('lpfhraIdUpload');
    const lpfhraIdUploadBtn = document.getElementById('lpfhraIdUploadBtn');
    const lpfhraIdPreview = document.getElementById('lpfhraIdPreview');
    const lpfhraIdStatus = document.getElementById('lpfhraIdStatus');
    const lpfhraIdNumberInput = document.getElementById('lpfhraIdNumber');
    
  
    const idCardTypeSelect = document.getElementById('idCardType');
    
   
    const ninVoterUtilitySection = document.getElementById('ninVoterUtilitySection');
    const ninVoterUpload = document.getElementById('ninVoterUpload');
    const ninVoterUploadBtn = document.getElementById('ninVoterUploadBtn');
    const ninVoterPreview = document.getElementById('ninVoterPreview');
    const ninVoterStatus = document.getElementById('ninVoterStatus');
    const ninVoterNumberInput = document.getElementById('ninVoterNumber');
    
    const utilityBillUpload = document.getElementById('utilityBillUpload');
    const utilityBillUploadBtn = document.getElementById('utilityBillUploadBtn');
    const utilityBillPreview = document.getElementById('utilityBillPreview');
    const utilityBillStatus = document.getElementById('utilityBillStatus');
    
   
    const countrySelect = document.getElementById('country');
    const otherLocationSection = document.getElementById('otherLocationSection');
    const otherStateInput = document.getElementById('otherState');
    const otherLGAInput = document.getElementById('otherLGA');
    
    const stateLGASection = document.getElementById('stateLGASection');
    const stateSelect = document.getElementById('state');
    const lgaSection = document.getElementById('lgaSection');
    const lgaSelect = document.getElementById('lga');
    
    
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const togglePasswordIcons = document.querySelectorAll('.toggle-password');
    
   
    const positionSelect = document.getElementById('position');
    const otherPositionInput = document.getElementById('otherPosition');
    
   
    setTimeout(() => {
        preloader.classList.add('hidden');
    }, 1500);

   
    function showNotification(message, type = 'info', duration = 5000) {
        const container = document.getElementById('notificationContainer');
        const notification = document.createElement('div');
        notification.classList.add('notification', type);
        
        let icon = '';
        if (type === 'success') icon = '<i class="fas fa-check-circle icon"></i>';
        else if (type === 'error') icon = '<i class="fas fa-times-circle icon"></i>';
        else icon = '<i class="fas fa-info-circle icon"></i>';
        
        notification.innerHTML = `
            ${icon}
            <span class="message">${message}</span>
            <button class="close-btn">&times;</button>
        `;
        container.appendChild(notification);
        
        notification.querySelector('.close-btn').addEventListener('click', () => {
            notification.style.animation = 'fadeOut 0.5s forwards';
            setTimeout(() => notification.remove(), 500);
        });
        
        if (duration) {
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.5s forwards';
                setTimeout(() => notification.remove(), 500);
            }, duration);
        }
    }
    
    async function getIpAddress() {
        try {
            const response = await fetch('https://api64.ipify.org?format=json');
            const data = await response.json();
            return data.ip;
        } catch (error) {
            console.error('Error fetching IP address:', error);
            return null;
        }
    }

    async function uploadToImgur(base64) {
        try {
            const res = await fetch("https://api.imgur.com/3/image", {
                method: "POST",
                headers: { Authorization: "Client-ID 5acf7eff9c91660" },
                body: new URLSearchParams({ image: base64, type: "base64" })
            });
            const data = await res.json();
            if (data.success && data.data && data.data.link) {
                return data.data.link;
            }
        } catch (err) {
            console.error("Error uploading to Imgur:", err);
        }
        return null;
    }
    
    function readFileAsBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = error => reject(error);
            reader.readAsDataURL(file);
        });
    }

    async function verifyDocumentContent(file) {
        return new Promise(resolve => {
            const reader = new FileReader();
            reader.onload = () => {
                const img = new Image();
                img.onload = () => {
                    const isValid = img.width > 100 && img.height > 100 && file.size < 5 * 1024 * 1024;
                    if (file.type.startsWith('image/')) {
                        resolve(isValid ? { success: true, message: 'Document appears valid (simulated).' } : { success: false, message: 'Document content could not be verified. Please upload a clear official document.' });
                    } else {
                        resolve({ success: false, message: 'Invalid file type. Please upload an image.' });
                    }
                };
                img.onerror = () => {
                    resolve({ success: false, message: 'Could not process image for verification.' });
                };
                img.src = reader.result;
            };
            reader.onerror = () => {
                resolve({ success: false, message: 'Failed to read file for verification.' });
            };
            reader.readAsDataURL(file);
        });
    }
 
    function triggerFileUpload(inputElement) {
        const dialog = document.createElement('div');
        dialog.classList.add('upload-dialog');
        dialog.innerHTML = `
            <p>Choose an option:</p>
            <button id="cameraOption"><i class="fas fa-camera"></i> Take Photo</button>
            <button id="galleryOption"><i class="fas fa-image"></i> Choose from Gallery</button>
            <button id="cancelUpload">Cancel</button>
        `;
        document.body.appendChild(dialog);
        dialog.style.position = 'fixed';
        dialog.style.top = '50%';
        dialog.style.left = '50%';
        dialog.style.transform = 'translate(-50%, -50%)';
        dialog.style.zIndex = '10001';
        dialog.style.background = '#1B263B';
        dialog.style.padding = '25px';
        dialog.style.borderRadius = '10px';
        dialog.style.boxShadow = '0 5px 20px rgba(0,0,0,0.5)';
        dialog.style.display = 'flex';
        dialog.style.flexDirection = 'column';
        dialog.style.gap = '10px';

        dialog.querySelector('#cameraOption').addEventListener('click', () => {
            if (inputElement.id === 'profilePhotoUpload') {
                inputElement.setAttribute('capture', 'user');
            } else {
                inputElement.setAttribute('capture', 'environment');
            }
            inputElement.click();
            dialog.remove();
        });
        
        dialog.querySelector('#galleryOption').addEventListener('click', () => {
            inputElement.removeAttribute('capture');
            inputElement.click();
            dialog.remove();
        });
        
        dialog.querySelector('#cancelUpload').addEventListener('click', () => {
            dialog.remove();
        });
    }
    
   
    profileUploadBtn.addEventListener('click', () => triggerFileUpload(profilePhotoUpload));
    lpfhraIdUploadBtn.addEventListener('click', () => triggerFileUpload(lpfhraIdUpload));
    ninVoterUploadBtn.addEventListener('click', () => triggerFileUpload(ninVoterUpload));
    utilityBillUploadBtn.addEventListener('click', () => triggerFileUpload(utilityBillUpload));
    
    profilePhotoUpload.addEventListener('change', async (event) => {
        const file = event.target.files[0];
        if (file) {
            profileStatus.textContent = 'Uploading...';
            profileStatus.style.color = '#BDD2F0';
            profilePreview.src = URL.createObjectURL(file);
            const base64 = await readFileAsBase64(file);
            if (base64) {
                const link = await uploadToImgur(base64);
                if (link) {
                    profilePhotoLink = link;
                    profileStatus.innerHTML = '<i class="fas fa-check-circle"></i> Photo uploaded successfully!';
                    profileStatus.style.color = '#72E0A4';
                } else {
                    profilePhotoLink = '';
                    profileStatus.innerHTML = '<i class="fas fa-times-circle"></i> Failed to upload photo. Try again.';
                    profileStatus.style.color = '#FF6B6B';
                    profilePreview.src = 'https://via.placeholder.com/150?text=Profile+Photo';
                }
            } else {
                profilePhotoLink = '';
                profileStatus.innerHTML = '<i class="fas fa-times-circle"></i> Failed to read file.';
                profileStatus.style.color = '#FF6B6B';
                profilePreview.src = 'https://via.placeholder.com/150?text=Profile+Photo';
            }
        } else {
            profilePhotoLink = '';
            profileStatus.textContent = '';
            profilePreview.src = 'https://via.placeholder.com/150?text=Profile+Photo';
        }
    });

    lpfhraIdUpload.addEventListener('change', async (event) => {
        const file = event.target.files[0];
        if (file) {
            lpfhraIdStatus.textContent = 'Uploading and verifying...';
            lpfhraIdStatus.style.color = '#BDD2F0';
            lpfhraIdPreview.src = URL.createObjectURL(file);
            lpfhraIdPreview.style.display = 'block';
            const verificationResult = await verifyDocumentContent(file);
            if (!verificationResult.success) {
                lpfhraIdCardLink = '';
                lpfhraIdStatus.innerHTML = `<i class="fas fa-times-circle"></i> ${verificationResult.message}`;
                lpfhraIdStatus.style.color = '#FF6B6B';
                showNotification(verificationResult.message, 'error', 8000);
                lpfhraIdPreview.style.display = 'none';
                return;
            }
            const base64 = await readFileAsBase64(file);
            if (base64) {
                const link = await uploadToImgur(base64);
                if (link) {
                    lpfhraIdCardLink = link;
                    lpfhraIdStatus.innerHTML = '<i class="fas fa-check-circle"></i> LPFHRA ID uploaded successfully!';
                    lpfhraIdStatus.style.color = '#72E0A4';
                } else {
                    lpfhraIdCardLink = '';
                    lpfhraIdStatus.innerHTML = '<i class="fas fa-times-circle"></i> Failed to upload LPFHRA ID. Try again.';
                    lpfhraIdStatus.style.color = '#FF6B6B';
                    lpfhraIdPreview.style.display = 'none';
                }
            } else {
                lpfhraIdCardLink = '';
                lpfhraIdStatus.innerHTML = '<i class="fas fa-times-circle"></i> Failed to read file.';
                lpfhraIdStatus.style.color = '#FF6B6B';
                lpfhraIdPreview.style.display = 'none';
            }
        } else {
            lpfhraIdCardLink = '';
            lpfhraIdStatus.textContent = '';
            lpfhraIdPreview.style.display = 'none';
        }
    });
    
    idCardTypeSelect.addEventListener('change', () => {
        ninVoterUtilitySection.style.display = 'none';
        ninVoterUpload.required = false;
        ninVoterNumberInput.required = false;
        utilityBillUpload.required = false;
        
        const selectedType = idCardTypeSelect.value;
        if (selectedType === 'nin' || selectedType === 'voter') {
            ninVoterUtilitySection.style.display = 'block';
            ninVoterUpload.required = true;
            ninVoterNumberInput.required = true;
            utilityBillUpload.required = true;
        }
    });
    
    ninVoterUpload.addEventListener('change', async (event) => {
        const file = event.target.files[0];
        if (file) {
            ninVoterStatus.textContent = 'Uploading and verifying...';
            ninVoterStatus.style.color = '#BDD2F0';
            ninVoterPreview.src = URL.createObjectURL(file);
            ninVoterPreview.style.display = 'block';
            const verificationResult = await verifyDocumentContent(file);
            if (!verificationResult.success) {
                ninVoterCardLink = '';
                ninVoterStatus.innerHTML = `<i class="fas fa-times-circle"></i> ${verificationResult.message}`;
                ninVoterStatus.style.color = '#FF6B6B';
                showNotification(verificationResult.message, 'error', 8000);
                ninVoterPreview.style.display = 'none';
                return;
            }
            const base64 = await readFileAsBase64(file);
            if (base64) {
                const link = await uploadToImgur(base64);
                if (link) {
                    ninVoterCardLink = link;
                    ninVoterStatus.innerHTML = '<i class="fas fa-check-circle"></i> Card uploaded successfully!';
                    ninVoterStatus.style.color = '#72E0A4';
                } else {
                    ninVoterCardLink = '';
                    ninVoterStatus.innerHTML = '<i class="fas fa-times-circle"></i> Failed to upload card. Try again.';
                    ninVoterStatus.style.color = '#FF6B6B';
                    ninVoterPreview.style.display = 'none';
                }
            } else {
                ninVoterCardLink = '';
                ninVoterStatus.innerHTML = '<i class="fas fa-times-circle"></i> Failed to read file.';
                ninVoterStatus.style.color = '#FF6B6B';
                ninVoterPreview.style.display = 'none';
            }
        } else {
            ninVoterCardLink = '';
            ninVoterStatus.textContent = '';
            ninVoterPreview.style.display = 'none';
        }
    });
    
    utilityBillUpload.addEventListener('change', async (event) => {
        const file = event.target.files[0];
        if (file) {
            utilityBillStatus.textContent = 'Uploading and verifying...';
            utilityBillStatus.style.color = '#BDD2F0';
            utilityBillPreview.src = URL.createObjectURL(file);
            utilityBillPreview.style.display = 'block';
            const verificationResult = await verifyDocumentContent(file);
            if (!verificationResult.success) {
                utilityBillLink = '';
                utilityBillStatus.innerHTML = `<i class="fas fa-times-circle"></i> ${verificationResult.message}`;
                utilityBillStatus.style.color = '#FF6B6B';
                showNotification(verificationResult.message + ' Please contact administration if you need assistance.', 'error', 8000);
                utilityBillPreview.style.display = 'none';
                return;
            }
            const base64 = await readFileAsBase64(file);
            if (base64) {
                const link = await uploadToImgur(base64);
                if (link) {
                    utilityBillLink = link;
                    utilityBillStatus.innerHTML = '<i class="fas fa-check-circle"></i> Document uploaded successfully!';
                    utilityBillStatus.style.color = '#72E0A4';
                } else {
                    utilityBillLink = '';
                    utilityBillStatus.innerHTML = '<i class="fas fa-times-circle"></i> Failed to upload document. Try again.';
                    utilityBillStatus.style.color = '#FF6B6B';
                    utilityBillPreview.style.display = 'none';
                }
            } else {
                utilityBillLink = '';
                utilityBillStatus.innerHTML = '<i class="fas fa-times-circle"></i> Failed to read file.';
                utilityBillStatus.style.color = '#FF6B6B';
                utilityBillPreview.style.display = 'none';
            }
        } else {
            utilityBillLink = '';
            utilityBillStatus.textContent = '';
            utilityBillPreview.style.display = 'none';
        }
    });
    
    togglePasswordIcons.forEach(icon => {
        icon.addEventListener('click', () => {
            const input = icon.previousElementSibling;
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });
    });
    
   

const _COUNTRIES = [
 { code: "US", name: "United States" },
    { code: "GB", name: "United Kingdom" },
    { code: "DE", name: "Germany" },
    { code: "FR", name: "France" },
    { code: "CN", name: "China" },
    { code: "IN", name: "India" },
    { code: "JP", name: "Japan" },
    { code: "AU", name: "Australia" },
    { code: "Nigeria", name: "Nigeria" },
    { code: "NE", name: "Niger" },
    { code: "GH", name: "Ghana" },
    { code: "TD", name: "Chad" },
    { code: "CM", name: "Cameroon" },
    { code: "BJ", name: "Benin" },
    { code: "TG", name: "Togo" },
    { code: "SD", name: "Sudan" },
    { code: "CI", name: "Côte d'Ivoire" },
    { code: "BD", name: "Bangladesh" },
    { code: "CF", name: "Central African Republic" },
    { code: "ML", name: "Mali" },
    { code: "SN", name: "Senegal" },
    { code: "GN", name: "Guinea" },
    { code: "BF", name: "Burkina Faso" },
    { code: "GM", name: "Gambia" },
    { code: "SL", name: "Sierra Leone" },
    { code: "LR", name: "Liberia" },
    { code: "GW", name: "Guinea-Bissau" },
    { code: "CV", name: "Cabo Verde" },
    { code: "MR", name: "Mauritania" },
    { code: "EG", name: "Egypt" },
    { code: "LY", name: "Libya" },
    { code: "DZ", name: "Algeria" },
    { code: "TN", name: "Tunisia" },
    { code: "MA", name: "Morocco" },
    { code: "ET", name: "Ethiopia" },
    { code: "SO", name: "Somalia" },
    { code: "KE", name: "Kenya" },
    { code: "UG", name: "Uganda" },
    { code: "TZ", name: "Tanzania" },
    { code: "RW", name: "Rwanda" },
    { code: "BI", name: "Burundi" },
    { code: "CD", name: "DR Congo" },
    { code: "CG", name: "Republic of the Congo" },
    { code: "AO", name: "Angola" },
    { code: "ZA", name: "South Africa" },
    { code: "ZM", name: "Zambia" },
    { code: "ZW", name: "Zimbabwe" },
    { code: "MZ", name: "Mozambique" },
    { code: "MG", name: "Madagascar" },
    { code: "CM", name: "Comoros" },
    { code: "MU", name: "Mauritius" },
    { code: "SC", name: "Seychelles" },
    { code: "BJ", name: "Benin" },
    { code: "CI", name: "Ivory Coast (Côte d'Ivoire)" },
    { code: "AO", name: "Angola" },
    { code: "BW", name: "Botswana" },
    { code: "MZ", name: "Mozambique" },
    { code: "NA", name: "Namibia" },
    { code: "ZA", name: "South Africa" },
    { code: "SZ", name: "Eswatini" },
    { code: "LS", name: "Lesotho" },
    { code: "GH", name: "Ghana" },
    { code: "TO", name: "Togo" },
    { code: "NE", name: "Niger" },
    { code: "CM", name: "Cameroon" },
    { code: "TD", name: "Chad" },
    { code: "SD", name: "Sudan" },
    { code: "ET", name: "Ethiopia" },
    { code: "DJ", name: "Djibouti" },
    { code: "ER", name: "Eritrea" },
    { code: "SO", name: "Somalia" },
    { code: "Other", name: "Other (Specify below)" }
];


    _COUNTRIES.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.code;
        opt.textContent = c.name;
        countrySelect.appendChild(opt);
    });
    
    const statesLgas = {
        "Abia": ["Aba North","Aba South","Arochukwu","Bende","Ikwuano","Isiala Ngwa North","Isiala Ngwa South","Isuikwuato","Obi Ngwa","Ohafia","Osisioma","Ugwunagbo","Ukwa East","Ukwa West","Umuahia North","Umuahia South","Umu Nneochi"],
        "Adamawa": ["Demsa","Fufore","Ganye","Gayuk","Gombi","Grie","Hong","Jada","Lamurde","Madagali","Maiha","Mayo Belwa","Michika","Mubi North","Mubi South","Numan","Shelleng","Song","Toungo","Yola North","Yola South"],
        "Akwa Ibom": ["Abak","Eastern Obolo","Eket","Esit Eket","Essien Udim","Etim Ekpo","Etinan","Ibeno","Ibesikpo Asutan","Ibiono-Ibom","Ika","Ikono","Ikot Abasi","Ikot Ekpene","Ini","Itu","Mbo","Mkpat-Enin","Nsit-Atai","Nsit-Ibom","Nsit-Ubium","Obot Akara","Okobo","Onna","Oron","Oruk Anam","Udung-Uko","Ukanafun","Uruan","Urue-Offong/Oruko","Uyo"],
        "Anambra": ["Aguata","Anambra East","Anambra West","Anaocha","Awka North","Awka South","Ayamelum","Dunukofia","Ekwusigo","Idemili North","Idemili South","Ihiala","Njikoka","Nnewi North","Nnewi South","Ogbaru","Onitsha North","Onitsha South","Orumba North","Orumba South","Oyi"],
        "Bauchi": ["Alkaleri","Bauchi","Bogoro","Damban","Darazo","Dass","Gamawa","Ganjuwa","Giade","Itas/Gadau","Jama'are","Katagum","Kirfi","Misau","Ningi","Shira","Tafawa Balewa","Toro","Warji","Zaki"],
        "Bayelsa": ["Brass","Ekeremor","Kolokuma/Opokuma","Nembe","Ogbia","Sagbama","Southern Ijaw","Yenagoa"],
        "Benue": ["Ado","Agatu","Apa","Buruku","Gboko","Guma","Gwer East","Gwer West","Katsina-Ala","Konshisha","Kwande","Logo","Makurdi","Obi","Ogbadibo","Ohimini","Oju","Okpokwu","Otukpo","Tarka","Ukum","Ushongo","Vandeikya"],
        "Borno": ["Abadam","Askira/Uba","Bama","Bayo","Biu","Chibok","Damboa","Dikwa","Gubio","Guzamala","Gwoza","Hawul","Jere","Kaga","Kala/Balge","Konduga","Kukawa","Kwaya Kusar","Mafa","Magumeri","Maiduguri","Marte","Mobbar","Monguno","Ngala","Nganzai","Shani"],
        "Cross River": ["Abi","Akamkpa","Akpabuyo","Bakassi","Bekwarra","Biase","Boki","Calabar Municipal","Calabar South","Etung","Ikom","Obanliku","Obubra","Obudu","Odukpani","Ogoja","Yakuur","Yala"],
        "Delta": ["Aniocha North","Aniocha South","Bomadi","Burutu","Ethiope East","Ethiope West","Ika North East","Ika South","Isoko North","Isoko South","Ndokwa East","Ndokwa West","Okpe","Oshimili North","Oshimili South","Patani","Sapele","Udu","Ughelli North","Ughelli South","Ukwuani","Uvwie","Warri North","Warri South","Warri South West"],
        "Ebonyi": ["Abakaliki","Afikpo North","Afikpo South","Ebonyi","Ezza North","Ezza South","Ikwo","Ishielu","Ivo","Izzi","Ohaozara","Ohaukwu","Onicha"],
        "Edo": ["Akoko-Edo","Egor","Esan Central","Esan North-East","Esan South-East","Esan West","Etsako Central","Etsako East","Etsako West","Igueben","Ikpoba-Okha","Oredo","Orhionmwon","Ovia North-East","Ovia South-West","Owan East","Owan West","Uhunmwonde"],
        "Ekiti": ["Ado Ekiti","Efon","Ekiti East","Ekiti South-West","Ekiti West","Emure","Gbonyin","Ido Osi","Ijero","Ikere","Ikole","Ilejemeje","Irepodun/Ifelodun","Ise/Orun","Moba","Oye"],
        "Enugu": ["Aninri","Awgu","Enugu East","Enugu North","Enugu South","Ezeagu","Igbo Etiti","Igbo Eze North","Igbo Eze South","Isi Uzo","Nkanu East","Nkanu West","Nkanu West","Nsukka","Oji River","Udenu","Udi","Uzo Uwani"],
        "FCT": ["Abaji","Bwari","Gwagwalada","Kuje","Kwali","Municipal Area Council"],
        "Gombe": ["Akko","Balanga","Billiri","Dukku","Funakaye","Gombe","Kaltungo","Kwami","Nafada","Shongom","Yamaltu/Deba"],
        "Imo": ["Aboh Mbaise","Ahiazu Mbaise","Ehime Mbano","Ezinihitte","Ideato North","Ideato South","Ihitte/Uboma","Ikeduru","Isiala Mbano","Isu","Mbaitoli","Ngor Okpala","Njaba","Nkwerre","Nwangele","Obowo","Oguta","Ohaji/Egbema","Okigwe","Orlu","Orsu","Oru East","Oru West","Owerri Municipal","Owerri North","Owerri West"],
        "Jigawa": ["Auyo","Babura","Biriniwa","Birnin Kudu","Buji","Dutse","Gagarawa","Garki","Gumel","Guri","Gwaram","Gwiwa","Hadejia","Jahun","Kafin Hausa","Kaugama","Kazaure","Kiri Kasama","Kiyawa","Maigatari","Malam Madori","Miga","Ringim","Roni","Sule Tankarkar","Taura","Yankwashi"],
        "Kaduna": ["Birnin Gwari","Chikun","Giwa","Igabi","Ikara","Jaba","Jema'a","Kachia","Kaduna North","Kaduna South","Kagarko","Kajuru","Kaura","Kauru","Kubau","Kudan","Lere","Makarfi","Sabon Gari","Sanga","Soba","Zangon Kataf","Zaria"],
        "Kano": ["Ajingi","Albasu","Bagwai","Bebeji","Bichi","Bunkure","Dala","Dambatta","Dawakin Kudu","Dawakin Tofa","Doguwa","Fagge","Gabasawa","Garko","Garun Mallam","Gaya","Gezawa","Gwale","Gwarzo","Kabo","Kano Municipal","Karaye","Kibiya","Kiru","Kumbotso","Kunchi","Kura","Madobi","Makoda","Minjibir","Nasarawa","Rano","Rimin Gado","Rogo","Shanono","Sumaila","Takai","Tarauni","Tofa","Tsanyawa","Tudun Wada","Ungogo","Warawa","Wudil"],
        "Katsina": ["Bakori","Batagarawa","Batsari","Baure","Bindawa","Charanchi","Dandume","Danja","Dan Musa","Daura","Dutsi","Dutsin Ma","Faskari","Funtua","Ingawa","Jibia","Kafur","Kaita","Kankara","Kankia","Katsina","Kurfi","Kusada","Mai'Adua","Malumfashi","Mani","Mashi","Matazu","Musawa","Rimi","Sabuwa","Safana","Sandamu","Zango"],
        "Kebbi": ["Aleiro","Arewa Dandi","Argungu","Augie","Bagudo","Birnin Kebbi","Bunza","Dandi","Fakai","Gwandu","Jega","Kalgo","Koko/Besse","Maiyama","Ngaski","Sakaba","Shanga","Suru","Wasagu/Danko","Yauri","Zuru"],
        "Kogi": ["Adavi","Ajaokuta","Ankpa","Bassa","Dekina","Ibaji","Idah","Igalamela Odolu","Ijumu","Kabba/Bunu","Kogi","Lokoja","Mopa-Muro","Ofu","Ogori/Magongo","Okehi","Okene","Olamaboro","Omala","Yagba East","Yagba West"],
        "Kwara": ["Asa","Baruten","Edu","Ekiti","Ifelodun","Ilorin East","Ilorin South","Ilorin West","Irepodun","Isin","Kaiama","Moro","Offa","Oke Ero","Oyun","Pategi"],
        "Lagos": ["Agege","Ajeromi-Ifelodun","Alimosho","Amuwo-Odofin","Apapa","Badagry","Epe","Eti Osa","Ibeju-Lekki","Ifako-Ijaiye","Ikeja","Ikorodu","Kosofe","Lagos Island","Lagos Mainland","Mushin","Ojo","Oshodi-Isolo","Shomolu","Surulere"],
        "Nasarawa": ["Akwanga","Awe","Doma","Karu","Keana","Keffi","Kokona","Lafia","Nasarawa","Nasarawa Egon","Obi","Toto","Wamba"],
        "Niger": ["Agaie","Agwara","Bida","Borgu","Bosso","Chanchaga","Edati","Gbako","Gurara","Katcha","Kontagora","Lapai","Lavun","Magama","Mariga","Mashegu","Mokwa","Moya","Paikoro","Rafi","Rijau","Shiroro","Suleja","Tafa","Wushishi"],
        "Ogun": ["Abeokuta North","Abeokuta South","Ado-Odo/Ota","Egbado North","Egbado South","Ewekoro","Ifo","Ijebu East","Ijebu North","Ijebu North East","Ijebu Ode","Ikenne","Imeko Afon","Ipokia","Obafemi Owode","Odeda","Odogbolu","Ogun Waterside","Remo North","Shagamu"],
        "Ondo": ["Akoko North-East","Akoko North-West","Akoko South-East","Akoko South-West","Akure North","Akure South","Ese Odo","Idanre","Ifedore","Ilaje","Ile Oluji/Okeigbo","Irele","Odigbo","Okitipupa","Ondo East","Ondo West","Ose","Owo"],
        "Osun": ["Aiyedaade","Aiyedire","Atakunmosa East","Atakunmosa West","Boluwaduro","Boripe","Ede North","Ede South","Egbedore","Ejigbo","Ifedayo","Ifelodun","Ife Central","Ife East","Ife North","Ife South","Ifedore","Ila","Ilesa East","Ilesa West","Irepodun","Irewole","Isokan","Iwo","Obokun","Odo Otin","Ola Oluwa","Olorunda","Oriade","Orolu","Osogbo"],
        "Oyo": ["Afijio","Akinyele","Atiba","Atisbo","Egbeda","Ibadan North","Ibadan North-East","Ibadan North-West","Ibadan South-East","Ibadan South-West","Ibarapa Central","Ibarapa East","Ibarapa North","Ido","Irepo","Iseyin","Itesiwaju","Iwajowa","Kajola","Lagelu","Ogbomosho North","Ogbomosho South","Ogo Oluwa","Olorunsogo","Oluyole","Ona Ara","Orelope","Ori Ire","Oyo","Oyo East","Saki East","Saki West","Surulere"],
        "Plateau": ["Barkin Ladi","Bassa","Bokkos","Jos East","Jos North","Jos South","Kanam","Kanke","Langtang North","Langtang South","Mangu","Mikang","Pankshin","Qua'an Pan","Riyom","Shendam","Wase"],
        "Rivers": ["Abua/Odual","Ahoada East","Ahoada West","Akuku-Toru","Andoni","Asari-Toru","Bonny","Degema","Eleme","Emohua","Etche","Gokana","Ikwerre","Khana","Obio/Akpor","Ogba/Egbema/Ndoni","Ogu/Bolo","Okrika","Omuma","Opobo/Nkoro","Oyigbo","Port Harcourt","Tai"],
        "Sokoto": ["Binji","Bodinga","Dange Shuni","Gada","Goronyo","Gudu","Gwadabawa","Illela","Isa","Kebbe","Kware","Rabah","Sabon Birni","Shagari","Silame","Sokoto North","Sokoto South","Tambuwal","Tangaza","Tureta","Wamako","Wurno","Yabo"],
        "Taraba": ["Ardo Kola","Bali","Donga","Gashaka","Gassol","Ibi","Jalingo","Karim Lamido","Kumi","Lau","Sardauna","Takum","Ussa","Wukari","Yorro","Zing"],
        "Yobe": ["Bade","Bursari","Damaturu","Fika","Fune","Geidam","Gujba","Gulani","Jakusko","Karasuwa","Machina","Nangere","Nguru","Potiskum","Tarmuwa","Yunusari","Yusufari"],
        "Zamfara": ["Anka","Bakura","Birnin Magaji/Kiyaw","Bukkuyum","Bungudu","Gummi","Gusau","Kaura Namoda","Maradun","Maru","Shinkafi","Talata Mafara","Chafe","Zurmi"]
    };
    
    countrySelect.addEventListener('change', function() {
        const selectedCountry = countrySelect.value;
        if (selectedCountry === 'Nigeria') {
            stateLGASection.style.display = 'block';
            lgaSection.style.display = 'block';
            otherLocationSection.style.display = 'none';
            otherStateInput.required = false;
            otherLGAInput.required = false;
            stateSelect.required = true;
            lgaSelect.required = true;
            stateSelect.innerHTML = `<option value="">Select State...</option>`;
            for (const state in statesLgas) {
                const opt = document.createElement('option');
                opt.value = state;
                opt.textContent = state;
                stateSelect.appendChild(opt);
            }
            lgaSelect.disabled = true;
        } else {
            stateLGASection.style.display = 'none';
            lgaSection.style.display = 'none';
            otherLocationSection.style.display = 'block';
            stateSelect.required = false;
            lgaSelect.required = false;
            otherStateInput.required = true;
            otherLGAInput.required = true;
        }
    });
    
    stateSelect.addEventListener('change', function() {
        const s = stateSelect.value;
        lgaSelect.innerHTML = `<option value="">Select LGA...</option>`;
        if (statesLgas[s]) {
            statesLgas[s].forEach(lga => {
                const opt = document.createElement('option');
                opt.value = lga;
                opt.textContent = lga;
                lgaSelect.appendChild(opt);
            });
            lgaSelect.disabled = false;
        } else {
            lgaSelect.disabled = true;
        }
    });
    
    const memberPositions = [
        "Ambassador", "Field Officer", "Legal Counsel", "Community Liaison", "Volunteer",
        "Advisory Board Member", "Executive Director", "Program Manager", "Research Analyst",
        "Human Rights Advocate", "Other"
    ];
    
    memberPositions.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p;
        opt.textContent = p;
        positionSelect.appendChild(opt);
    });
    
    positionSelect.addEventListener('change', () => {
        if (positionSelect.value === 'Other') {
            otherPositionInput.style.display = 'block';
            otherPositionInput.required = true;
        } else {
            otherPositionInput.style.display = 'none';
            otherPositionInput.required = false;
            otherPositionInput.value = '';
        }
    });
    
   
    registrationForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        preloader.classList.remove('hidden');

       
        const fullName = document.getElementById('fullName').value.trim();
        const email = document.getElementById('email').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const functionId = document.getElementById('functionId').value.trim();
        const gender = document.getElementById('gender').value;
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        const selectedIdCardType = idCardTypeSelect.value;
        const dob = document.getElementById('dob').value;
        const cityOrRegion = (countrySelect.value === 'Nigeria') ? lgaSelect.value : otherLGAInput.value.trim();

      
        if (!profilePhotoLink) {
            showNotification('Please upload your profile photo. It is required for registration.', 'error');
            preloader.classList.add('hidden');
            return;
        }

       
        if (password !== confirmPassword) {
            showNotification('Passwords do not match.', 'error');
            preloader.classList.add('hidden');
            return;
        }
        
        if (password.length < 6) {
            showNotification('Password must be at least 6 characters long.', 'error');
            preloader.classList.add('hidden');
            return;
        }

        let selectedPosition = positionSelect.value;
        if (selectedPosition === 'Other') {
            selectedPosition = otherPositionInput.value.trim();
            if (!selectedPosition) {
                showNotification('Please specify your position.', 'error');
                preloader.classList.add('hidden');
                return;
            }
        }
        
        let stateValue = '';
        let lgaValue = '';
        if (countrySelect.value === 'Nigeria') {
            stateValue = stateSelect.value;
            lgaValue = lgaSelect.value;
        } else {
            stateValue = otherStateInput.value.trim();
            lgaValue = otherLGAInput.value.trim();
            if (!stateValue || !lgaValue) {
                showNotification('Please enter your State/Province and City/Region.', 'error');
                preloader.classList.add('hidden');
                return;
            }
        }

        const ipAddress = await getIpAddress();
        
        try {
           
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

          
            const userData = {
                uid: user.uid,
                fullName: fullName,
                email: email,
                phoneNumber: phone,
                functionId: functionId,
                gender: gender,
                dob: dob,
                position: selectedPosition,
                country: countrySelect.value,
                state: stateValue,
                lga: lgaValue,
                ipAddress: ipAddress,
                profilePhoto: profilePhotoLink,
                lpfhraIdCard: lpfhraIdCardLink || null, 
                lpfhraIdNumber: lpfhraIdNumberInput.value.trim() || null, 
                idCardLink: ninVoterCardLink || null, 
                idCardType: selectedIdCardType || null, 
                idCardNumber: ninVoterNumberInput.value.trim() || null, 
                utilityBillLink: utilityBillLink || null,
                registrationDate: new Date().toISOString(),
                status: 'pending'
            };
            
         
            await set(ref(db, 'users/' + user.uid), userData);
            
           
            preloader.classList.add('hidden');
            showNotification(`Congratulations, ${fullName}! Your registration was successful. Welcome to LPFHRA.`, 'success', 5000);
            
            
            registrationForm.reset();
            profilePreview.src = 'https://via.placeholder.com/150?text=Profile+Photo';
            profileStatus.textContent = '';
           
            lpfhraIdPreview.style.display = 'none'; lpfhraIdStatus.textContent = ''; lpfhraIdCardLink = '';
            ninVoterPreview.style.display = 'none'; ninVoterStatus.textContent = ''; ninVoterCardLink = '';
            utilityBillPreview.style.display = 'none'; utilityBillStatus.textContent = ''; utilityBillLink = '';
            ninVoterUtilitySection.style.display = 'none';
            
          
            setTimeout(() => {
                window.location.href = `profile.html?uid=${user.uid}`;
            }, 3000);

        } catch (error) {
            preloader.classList.add('hidden');
            let errorMessage = "Registration failed. Please try again.";
            if (error.code === 'auth/email-already-in-use') {
                errorMessage = "This email is already registered. Please login or use a different email.";
            } else if (error.code) {
                errorMessage = `Registration failed: ${error.message}`;
            }
            console.error('Firebase Auth or Database error:', error);
            showNotification(errorMessage + '<br> <small>Contact administration if you need assistance.</small>', 'error', 8000);
        }
    });
});
    </script>
</body>
</html>
