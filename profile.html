<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>        
       
body {
    margin: 0;
    padding: 0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #0D1B2A, #1B263B, #415A77);
    background-repeat: no-repeat;
    background-attachment: fixed;
    background-size: cover;
    color: #ffffff;
    min-height: 100vh;
    line-height: 1.6;
}

#preloader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.5s ease;
}


.preloader-content {
    text-align: center;
}

.preloader-content img {
    width: 100px;
    height: 100px;
    animation: pulse 2s infinite;
    border-radius: 50%;
    box-shadow: 0 0 25px rgba(255, 255, 255, 0.25), 
                0 0 50px rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    background: rgba(255, 255, 255, 0.05);
    background: white;
    padding: 5px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.preloader-content img:hover {
    transform: scale(1.1);
    box-shadow: 0 0 30px rgba(255, 255, 255, 0.4), 
                0 0 60px rgba(255, 255, 255, 0.2);
}


.spinner {
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid #ffffff;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.preloader-content p {
    font-size: 1.2em;
    font-weight: 500;
}


@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}


.hidden {
    display: none !important;
}


.action-buttons-container {
    display: flex;
    justify-content: space-between;
    padding: 15px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.action-button {
    background: #415A77;
    color: #ffffff;
    border: none;
    padding: 10px 15px;
    border-radius: 20px;
    font-size: 1em;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.action-button:hover {
    background: #778DA9;
    transform: translateY(-2px);
}

.new-post-btn {
    background: #1B263B;
}


.write-post-container {
    background: #1B263B;
    border-radius: 10px;
    padding: 20px;
    margin: 20px;
    position: relative;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

.close-post-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: #fff;
    font-size: 1.5em;
    cursor: pointer;
    transition: color 0.3s ease;
}

.close-post-btn:hover {
    color: #E0E1DD;
}

textarea#post-text {
    width: 100%;
    min-height: 100px;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 8px;
    padding: 15px;
    color: #fff;
    font-size: 1em;
    resize: vertical;
    box-sizing: border-box;
    margin-bottom: 15px;
}

textarea#post-text::placeholder {
    color: #E0E1DD;
    opacity: 0.7;
}

.post-upload-options {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

.post-upload-options button, .link-input-save-btn {
    background: #415A77;
    color: #fff;
    border: none;
    border-radius: 5px;
    padding: 10px 15px;
    cursor: pointer;
    transition: background 0.3s ease, transform 0.3s ease;
}

.post-upload-options button:hover, .link-input-save-btn:hover {
    background: #778DA9;
    transform: scale(1.05);
}



.link-input-wrapper {  
    display: flex; 
    flex-direction: column;
    gap: 10px;
    margin-bottom: 15px;
    padding: 15px;
    border: 1px solid #778DA9;
    border-radius: 8px;
    position: relative;
    background-color: #1B263B; 
}

.link-input-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
}

.link-input-header h4 {
    color: #E0E1DD;
    font-size: 1.1em;
    margin: 0;
}

#link-input-close-btn {
    background: none;
    border: none;
    color: #E0E1DD;
    cursor: pointer;
    font-size: 1.2em;
    padding: 5px; 
    transition: color 0.2s ease;
}

#link-input-close-btn:hover {
    color: #FF0000; 
}

.link-input-body {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.link-input-body label {
    color: #B0C4DE; 
    font-size: 0.9em;
    font-weight: 500;
    margin-top: 5px;
}

.link-input-body input {  
    width: 100%; 
    background: #415A77; 
    border: 1px solid #778DA9;
    border-radius: 5px;
    padding: 10px;
    color: #E0E1DD;
    box-sizing: border-box;
    transition: border-color 0.3s ease;
}

.link-input-body input:focus {
     border-color: #0077B6;
     outline: none;
}

.link-input-body input::placeholder {
    color: #B0C4DE;
    opacity: 0.7;
}


button#submit-post-btn {
    background: #415A77;
    color: #fff;
    border: none;
    padding: 12px 25px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 1em;
    display: block;
    width: 100%;
    transition: background 0.3s ease, transform 0.3s ease;
    margin-top: 15px;
}

button#submit-post-btn:hover {
    background: #1B263B;
    transform: translateY(-2px);
}


button#submit-post-btn:hover {
    background: #778DA9;
    transform: translateY(-2px);
}

.post-card {
    background: transparent;
    border-radius: 0;
    margin: 20px 0;
    padding: 0;
    box-shadow: none;
    border: none;
    
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.post-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 10px;
    padding-left: 15px;
    padding-right: 15px;
}
.post-user-info {
    display: flex;
    align-items: center;
    gap: 10px;
}
.post-user-info .profile-photo {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #415A77;
}
.user-details {
    display: flex;
    flex-direction: column;
    position: relative;
    top: 0; 
    left: 0; 
}
.user-details h4 {
    margin: 0;
    font-size: 13px;
    color: #E0E1DD;
}
.user-meta {
    font-size: 0.8em;
    color: #778DA9;
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    white-space: nowrap; 
    overflow: hidden;
    text-overflow: ellipsis;
}
.post-options-container {
    position: relative; 
}
.post-options-btn {
    background: none;
    border: none;
    color: red;
    font-size: 1.2em;
    cursor: pointer;
    position: relative;
    z-index: 600;
}
.post-options-menu {
    position: absolute;
    top: 30px;
    right: 0;
    background: #1B263B;
    border: 1px solid #415A77;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    padding: 10px;
    
    display: none; 
    flex-direction: column; 
    min-width: 120px; 
    z-index: 1000; 
}

.post-options-menu:not(.hidden) {
    display: flex;
    
    align-items: flex-start; 
}

.post-options-menu button {
    display: block; 
    width: 100%;
    background: none;
    border: none;
    color: #fff;
    padding: 8px 12px;
    text-align: left;
    cursor: pointer;
    transition: background 0.3s ease;
}
.post-options-menu button:hover {
    background: #415A77;
}

.post-options-menu .close-options-menu {
    text-align: right; 
    padding: 5px;
    color: #fff;
    font-size: 1.2em;
    background: none;
    border: none;
    cursor: pointer;
}

.post-content {
    margin: 15px 15px 0 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.post-text {
    white-space: pre-wrap;
    word-wrap: break-word;
    margin-bottom: 10px;
    color: #E0E1DD;
}
.post-text.collapsed {
    max-height: 100px;
    overflow: hidden;
    position: relative;
}
.post-text.collapsed::after {
    content: '...';
    position: absolute;
    bottom: 0;
    right: 0;
    background: linear-gradient(to left, #1B263B, rgba(27, 38, 59, 0));
    padding-left: 20px;
}
.read-more-btn {
    background: none;
    border: none;
    color: #778DA9;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.9em;
}
.post-media-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 10px;
    
}
.post-media-container img,
.post-media-container video {
    width: 100%;
    height: auto;
    object-fit: cover;
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.3s ease;
}
.post-media-container img:hover {
    transform: scale(1.02);
}
.post-media-container video {
    max-width: 100%;
}
.post-media-container audio {
    width: 100%;
    margin-top: 10px;
}


.post-footer {
    display: flex;
    justify-content: space-around;
    padding: 10px 15px;
    border-top: none;
    margin-top: 0;
}
.post-footer-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1.1rem;
    cursor: pointer;
}
.post-footer-item:hover {
    color: #E0E1DD;
}
.post-footer-item i {
    font-size: 1.2em;
}
.post-footer-item.like.liked i {
    color: #415A77;
}


.viewer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    transition: opacity 0.3s ease;
}


.viewer.hidden {
    display: none;
    opacity: 0;
}

.viewer img, .viewer video {
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
}

.viewer-close {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;   
    color: #fff;
    font-size: 2em;
    cursor: pointer;
    transition: color 0.3s ease;
}

.viewer-close:hover {
    color: #bbb;
}

.viewer-download {
    position: absolute;
    top: 20px;
    right: 70px;
    color: #fff;
    font-size: 2em;
    cursor: pointer;
}


#push-notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #415A77; 
    color: #E0E1DD;
    padding: 15px 25px;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    z-index: 1000;
  
    font-family: Arial, sans-serif;
    transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
}

#push-notification-container.hidden {
    display: none;
    opacity: 0;
    transform: translateY(-20px);
}


.footer {
padding: 20px;
    text-align: center;
    background-color: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    
    
}

.footer p {
    margin: 5px 0;
    color: #E0E1DD;
    font-size: 1.0rem;
}

.footer .social-icons {
    margin: 10px 0;
    font-size: 1.0rem;
}

.footer .social-icons a {
    color: #fff;
    font-size: 1.5em;
    margin: 0 10px;
    transition: color 0.3s ease, transform 0.3s ease;
}

.footer .social-icons a:hover {
    color: #778DA9;
    transform: scale(1.1);
}

.footer .contact-link {
    color: #778DA9;
    text-decoration: none;
    font-weight: 600;
}


#image-viewer-profile {
    display: none; 
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.3s ease;
}

#image-viewer-profile.hidden {
    display: none;
    opacity: 0;
}

#image-viewer-profile .viewer-content {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
}

#viewer-profile-image {
    max-width: 90%;
    max-height: 90%;
    display: block;
    margin: auto;
}

#image-viewer-profile .viewer-close { 
    position: absolute;
    top: 20px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    transition: 0.3s;
    cursor: pointer;
}

#image-viewer-profile .viewer-close:hover,
#image-viewer-profile .viewer-close:focus {
    color: #bbb;
    text-decoration: none;
    cursor: pointer;
}


#user-info-container {
    position: absolute;
    top: 300px;
    left: 2px;
    color: #fff;
    padding: 10px;
}

#user-info-container h1 {
    font-size: 24px;
    margin: 0;
}

#user-info-container p {
    font-size: 16px;
    margin: 5px 0 0 0;
}


        .edit-post-textarea {
            width: calc(100% - 20px); 
            min-height: 150px;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #415A77;
            background-color: #0D1B2A;
            color: #E0E1DD;
            font-family: 'Poppins', sans-serif;
            font-size: 1em;
            resize: vertical; 
        }

        .edit-post-actions {
            display: flex;
            justify-content: flex-end; 
            gap: 10px;
        }

        .edit-post-actions button {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s ease;
        }

        .edit-post-save-btn {
            background: #2d8cf0;
            color: #fff;
        }

        .edit-post-save-btn:hover {
            background: #1e6ec7;
        }

        .edit-post-cancel-btn {
            background: #778DA9;
            color: #fff;
        }

        .edit-post-cancel-btn:hover {
            background: #5a6e87;
        }

.viewer {
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex; 
    align-items: center;
    justify-content: center;
    transition: opacity 0.3s ease;
}

.viewer.hidden {
    display: none;
}

.viewer-close {
    position: absolute;
    top: 20px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    transition: 0.3s;
    cursor: pointer;
    background: none;
    border: none;
}

.viewer-close:hover,
.viewer-close:focus {
    color: #bbb;
    text-decoration: none;
}


#viewer-image, #viewer-video, #viewer-profile-image {
    max-width: 90%;
    max-height: 90%;
    display: block;
    margin: auto;
}

#image-viewer-profile .viewer-content {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
}

#viewer-profile-badge {
    position: absolute;
    bottom: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 2px solid #fff;
}


.site1-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%); 
    background: rgba(13, 27, 42, 0.9);
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    z-index: 2000;
    width: 90%;
    max-width: 500px;
    padding: 20px;
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translate(-50%, -60%);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%);
    }
}


      
.header {
     background-color: rgba(0, 0, 0, 0.3);
            border-bottom: 3px solid #415A77;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
}

.header-left .logo {
    height: 40px;
    width: 40px;
    border-radius: 10px;
    object-fit: contain;
    background: #fff;
    border: 2px solid #415A77;
    transition: transform 0.3s ease;
}

.header-left .logo:hover {
    transform: scale(1.05);
}

.header-nav {
    display: flex;
    gap: 15px;
}

.nav-icon {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #E0E1DD;
    text-decoration: none;
    font-size: 1.5em;
    transition: color 0.3s ease;
}

.nav-icon:hover {
    color: #2d8cf0;
}

.nav-text {
    font-size: 0.7em;
    margin-top: 5px;
    color: #B2B8BC;
}



.main-content {
    padding-top: 8px;
    margin: 0;
    padding-left: 0px;
    padding-right: 0px;
    min-height: 100%;
    background: #1B263B;
    color: #E0E1DD;
    display: flex;
    flex-direction: column;
    align-items: none;
    text-align: none;
}


.profile-container {       
    border-radius: 15px;
    overflow: hidden;
    margin: 40px auto;
    padding: 3px;
    position: relative;
    
    max-width: 600px;
}

.profile-banner-section {
    text-align: center;
}

.profile-banner {
    position: relative;
    width: 200px;
    height: 200px;
    border-radius: 50%;
    margin: 0 auto 15px;
    border: 4px solid #2d8cf0;
    background-color: #0D1B2A;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    cursor: pointer;
    transition: border-color 0.3s ease;
}

.profile-banner:hover {
    border-color: #ffd700;
}

#profile-photo {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
}

.profile-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.profile-banner:hover .profile-overlay {
    opacity: 1;
}

.camera-icon-btn {
    background: #2d8cf0;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-size: 1.2em;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    transition: background 0.3s ease;
}

.camera-icon-btn:hover {
    background: #1e6ec7;
}

#photo-upload {
    display: none;
}

#user-info-container h1 {
    font-size: 2em;
    margin: 0;
    font-weight: 600;
    color: #E0E1DD;
}

#user-info-container p {
    font-size: 1em;
    color: #778DA9;
    margin: 5px 0;
}


.user-info-separator {
    width: 80%;
    height: 1px;
    background: linear-gradient(to right, #415A77, rgba(65, 90, 119, 0));
    margin: 20px auto 0;
}


#image-viewer-profile {
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0.8);
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2000;
    padding: 20px;
}
.modal-content {
    max-width: 90%;
    max-height: 90%;
    display: block;
    margin: auto;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
}
.close-btn {
    position: absolute;
    top: 20px;
    right: 35px;
    color: #fff;
    font-size: 40px;
    font-weight: bold;
    transition: 0.3s;
    cursor: pointer;
}
.close-btn:hover,
.close-btn:focus {
    color: #bbb;
    text-decoration: none;
    cursor: pointer;
}
.hidden {
    display: none !important;
}


.post-options-menu button[data-action="translate"] {
    width: 100%;
    text-align: left;
    padding: 8px 15px;
    background: none;
    border: none;
    cursor: pointer;
    color: white;
    font-size: 14px;
}
.post-options-menu button[data-action="translate"]:hover {
    background-color: #f1f1f1;
    color: #000;
}


.other-lang-container { 
    display: none; 
    flex-direction: column;
    padding: 10px;
    gap: 5px;
}


.post-options-menu button[data-action="translate-other"] + .other-lang-container {
    display: flex;
}

.other-lang-container input {
    width: 100%;
    padding: 8px;
    border-radius: 5px;
    border: 1px solid #ccc;
}
.other-lang-container button {
    background-color: #007bff;
    color: #fff;
    border: none;
    padding: 8px;
    border-radius: 5px;
    cursor: pointer;
}
.other-lang-container button:hover {
    background-color: #0056b3;
}


.loading-spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #3498db;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
    display: inline-block;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
.loading-text-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}


.custom-notification-popup {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 15px;
    z-index: 1000;
    max-width: 350px;
    font-family: Arial, sans-serif;
    animation: fadeIn 0.5s ease-in-out;
}
.custom-notification-popup .close-btn {
    position: absolute;
    top: 5px;
    right: 10px;
    cursor: pointer;
    font-size: 1.2em;
}
.custom-notification-popup p {
    margin: 0 0 10px;
    color: #333;
    font-size: 16px;
}
.custom-notification-popup .learn-more-btn {
    display: inline-block;
    padding: 8px 12px;
    background-color: #007bff;
    color: #fff;
    border-radius: 5px;
    text-decoration: none;
    font-weight: bold;
    text-align: center;
}
.custom-notification-popup .learn-more-btn:hover {
    background-color: #0056b3;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}


#custom-notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
    max-width: 350px;
    pointer-events: none; 
}

.custom-notification-popup {
    pointer-events: auto; 
    background-color: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    margin-bottom: 15px;
    padding: 15px 20px;
    animation: fadeInSlideUp 0.5s ease-out forwards;
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease;
}

@keyframes fadeInSlideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.custom-notification-popup:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
}

.notification-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.notification-header h4 {
    margin: 0;
    color: #2d8cf0; 
    font-size: 1.1em;
    font-weight: 600;
}

.custom-notification-popup p {
    margin: 0 0 15px 0;
    color: #333;
    font-size: 0.95em;
    line-height: 1.4;
}

.close-btn {
    font-size: 1.2em;
    cursor: pointer;
    color: #aaa;
    transition: color 0.2s;
    background: none;
    border: none;
    padding: 5px;
    line-height: 1;
}

.close-btn:hover {
    color: #e74c3c;
}

.learn-more-btn {
    display: inline-block;
    background-color: #2d8cf0;
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: background-color 0.2s, transform 0.1s;
    font-size: 0.9em;
}

.learn-more-btn:hover {
    background-color: #1a73e8;
    transform: translateY(-1px);
}


.profile-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.3);
    opacity: 0;
    transition: opacity 0.3s;
    border-radius: 50%; 
}

.profile-banner:hover .profile-overlay {
    opacity: 1;
}

.camera-icon-btn {
    background: #007bff; 
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: background 0.2s;
}

.camera-icon-btn:hover {
    background: #0056b3;
}

.selected-images-preview {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    padding: 10px;
    border-top: 1px solid #eee;
    margin-top: 10px;
}

.image-preview-item {
    position: relative;
    width: 80px;
    height: 80px;
    overflow: hidden;
    border-radius: 8px;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
}

.image-preview-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.remove-image-btn {
    position: absolute;
    top: -5px;
    right: -5px;
    background: red;
    color: white;
    border: none;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    font-size: 12px;
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

    </style>
    </head>
<body>
   
    <div id="preloader">
    <div class="preloader-content">
        <img src="https://i.imgur.com/lwddsvh.png" alt="Loading Logo" />
        <div class="spinner"></div>
        <p>Peace is loadingâ€¦</p>
    </div>
</div>

<header class="header">
    <div class="header-left">
        <img src="https://i.imgur.com/lwddsvh.png" alt="Logo" class="logo">
    </div>
    <nav class="header-nav">
        <a href="index.html" class="nav-icon home-icon" aria-label="Home">
            <i class="fas fa-home"></i>
            <span class="nav-text">Home</span>
        </a>
        <a href="leadwayCourse.html" class="nav-icon user-icon hidden" id="courses-link" aria-label="Courses & Certificates">
            <i class="fas fa-user-graduate"></i>
            <span class="nav-text">Courses</span>
        </a>
        <a href="checkReport.html" class="nav-icon notes-icon hidden" id="notes-link" aria-label="My Documents">
            <i class="fas fa-sticky-note"></i>
            <span class="nav-text">My Center Report </span>
        </a>
    </nav>
</header>

<main class="main-content">
    
    <div class="profile-section">
    <div class="profile-banner">
        <img id="profile-photo" src="https://i.imgur.com/your-default-image.png" alt="Profile Photo">
        <div class="profile-overlay">
            <button class="camera-icon-btn hidden" id="upload-profile-photo-btn" aria-label="Upload Profile Photo">
                <i class="fas fa-camera"></i>
            </button>
            <input type="file" id="profile-photo-upload-input" accept="image/*" style="display: none;">
        </div>
    </div>
    
    </div>
        <div class="profile-details-text">
            <h3>
               <center> <span id="user-full-name">User Full Name</span> (<span id="user-position">Position</span>)
            </h3>
          </center><center>  <p id="user-location">Country, State</p> </center>
        </div>
    </div>
    
    
   <div class="action-buttons-container">
    <div class="action-buttons-left">
        <button id="share-profile-btn" class="action-button hidden">
            <i class="fas fa-share-alt"></i> Share Profile Link 
        </button>
    </div>
    <div class="action-buttons-right">
        <button id="new-post-btn" class="action-button new-post-btn hidden">
            <i class="fas fa-plus"></i> New Post
        </button>
    </div>
</div>

<div id="write-post-container" class="write-post-container hidden">
    <button class="close-post-btn" id="close-post-btn" aria-label="Close">
        <i class="fas fa-times"></i>
    </button>
    <textarea id="post-text" placeholder="What's on your mind?"></textarea>
    
    <div id="selected-images-preview" class="selected-images-preview">
    </div>

    <div id="link-input-container" class="link-input-wrapper hidden">
        <div class="link-input-header">
            <h4>Add Media Links (URL)</h4>
            <button id="link-input-close-btn" aria-label="Close link input">
                 <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="link-input-body">
            <label for="image-link-input">Input Image Link</label>
            <input type="url" id="image-link-input" placeholder="http://image-url.com, http://second-image.com">

            <label for="video-link-input"> Input Video Link </label>
            <input type="url" id="video-link-input" placeholder="http://video-url.mp4">

            <label for="audio-link-input">Input Audio Link </label>
            <input type="url" id="audio-link-input" placeholder="http://audio-url.mp3">
        </div>
    </div>
    <div class="post-upload-options">
        <button id="upload-image-btn" aria-label="Upload Image"><i class="fas fa-images"></i></button>
        <button id="upload-video-btn" aria-label="Upload Video"><i class="fas fa-video"></i></button>
        <button id="upload-audio-btn" aria-label="Upload Audio"><i class="fas fa-microphone"></i></button>
        
        <button id="link-input-btn" aria-label="Add Link"><i class="fas fa-link"></i></button>
    </div>

    <input type="file" id="post-image-upload-input" accept="image/*" multiple style="display: none;">
    <button id="submit-post-btn" class="post-button">Post</button>
</div>
        
        
    
    <div id="posts-container" class="posts-container">
        </div>
    
</main>

<div id="push-notification-container" class="push-notification-container hidden">
    <p id="notification-message"></p>
</div>

<div id="custom-notification"></div>

<div id="edit-post-modal" class="site1-modal hidden">
    <div class="site1-modal-content">
        <button class="site1-modal-close"><i class="fa-solid fa-times"></i></button>
        <h3 style="color: #2d8cf0; margin-top: 0;">Edit Your Post</h3>
        <textarea id="edit-post-textarea" class="edit-post-textarea"></textarea>
        <div class="edit-post-actions">
            <button id="edit-post-save-btn" class="edit-post-save-btn">Save Changes</button>
            <button id="edit-post-cancel-btn" class="edit-post-cancel-btn">Cancel</button>
        </div>
    </div>
</div>

<div id="image-viewer" class="viewer hidden">
    <button id="image-viewer-close" class="viewer-close"><i class="fa-solid fa-times"></i></button>
    <button id="image-viewer-download" class="viewer-download hidden"><i class="fa-solid fa-download"></i></button>
    <img id="viewer-image" src="" alt="Viewed Image">
</div>

<div id="video-viewer" class="viewer hidden">
    <button id="video-viewer-close" class="viewer-close"><i class="fa-solid fa-times"></i></button>
    <video id="viewer-video" controls autoplay src=""></video>
</div>

<div id="image-viewer-profile" class="viewer hidden">
    <button id="image-viewer-profile-close" class="viewer-close"><i class="fa-solid fa-times"></i></button>
    <div class="viewer-content">
        <img id="viewer-profile-image" src="" alt="Profile Photo">
        <img id="viewer-profile-badge" src="" alt="Support Team Badge" class="hidden">
    </div>

</div>
<footer class="footer">
    <p>Leadway Peace Functions And Human Rights Aids</p>
    <div class="social-icons">
        <a href="#" id="facebook-share" aria-label="Share on Facebook"><i class="fab fa-facebook"></i></a>
        <a href="#" id="email-share" aria-label="Share via Email"><i class="fas fa-envelope"></i></a>
        <a href="#" id="whatsapp-share" aria-label="Share on WhatsApp"><i class="fab fa-whatsapp"></i></a>
        <a href="#" id="telegram-share" aria-label="Share on Telegram"><i class="fab fa-telegram"></i></a>
        <a href="#" id="instagram-share" aria-label="Share on Instagram"><i class="fab fa-instagram"></i></a>
        <a href="#" id="x-share" aria-label="Share on X"><i class="fab fa-twitter"></i></a>
    </div>
    <p>Reg. 7373969</p>
    <p>Email: <a href="mailto:leawaypeacefoundation@gmail.com">info@lpfhra.org</a></p>
    <a href="contact.html" class="contact-link">Contact Us</a>
</footer>

   <script type="module">
import { app, analytics, firebaseConfig } from './firebase.js';
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
import { getDatabase, ref, get, set, push, update, remove, child, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

const auth = getAuth(app);
const db = getDatabase(app);
let currentUser = null;
let profileDataCache = null;
let postsDataCache = {};
let translationCache = {};
const imgurClientId = '5acf7eff9c91660';
const TRUNCATE_LIMIT = 200;


const preloader = document.getElementById('preloader');
const coursesLink = document.getElementById('courses-link');
const notesLink = document.getElementById('notes-link');
const profilePhoto = document.getElementById('profile-photo');

const uploadProfilePhotoBtn = document.getElementById('upload-profile-photo-btn');
const profilePhotoUploadInput = document.getElementById('profile-photo-upload-input');

const shareProfileBtn = document.getElementById('share-profile-btn');
const newPostBtn = document.getElementById('new-post-btn');
const writePostContainer = document.getElementById('write-post-container');
const closePostBtn = document.getElementById('close-post-btn');
const postTextarea = document.getElementById('post-text');
const postsContainer = document.getElementById('posts-container');
const submitPostBtn = document.getElementById('submit-post-btn');


const uploadImageBtn = document.getElementById('upload-image-btn');
const uploadVideoBtn = document.getElementById('upload-video-btn');
const uploadAudioBtn = document.getElementById('upload-audio-btn');
const postImageUploadInput = document.getElementById('post-image-upload-input'); 
const selectedImagesPreview = document.getElementById('selected-images-preview');
let selectedPostFiles = []; 


const linkInputBtn = document.getElementById('link-input-btn');
const linkInputContainer = document.getElementById('link-input-container');
const linkInputCloseBtn = document.getElementById('link-input-close-btn');
const imageLinkInput = document.getElementById('image-link-input');
const videoLinkInput = document.getElementById('video-link-input');
const audioLinkInput = document.getElementById('audio-link-input');


const imageViewer = document.getElementById('image-viewer');
const viewerImage = document.getElementById('viewer-image');
const imageViewerClose = document.getElementById('image-viewer-close');
const videoViewer = document.getElementById('video-viewer');
const viewerVideo = document.getElementById('viewer-video');
const videoViewerClose = document.getElementById('video-viewer-close');
const imageViewerProfile = document.getElementById('image-viewer-profile');
const viewerProfileImage = document.getElementById('viewer-profile-image');
const viewerProfileBadge = document.getElementById('viewer-profile-badge');
const imageViewerProfileClose = document.getElementById('image-viewer-profile-close');
const userFullName = document.getElementById('user-full-name');
const userPosition = document.getElementById('user-position');
const userLocation = document.getElementById('user-location');
const notificationContainer = document.getElementById('push-notification-container');
const notificationMessage = document.getElementById('notification-message');
const editPostModal = document.getElementById('edit-post-modal');
const editPostTextarea = document.getElementById('edit-post-textarea');
const editPostSaveBtn = document.getElementById('edit-post-save-btn');
const editPostCancelBtn = document.getElementById('edit-post-cancel-btn');
const editPostCloseBtn = editPostModal ? editPostModal.querySelector('.site1-modal-close') : null;
const customNotificationContainer = document.getElementById('custom-notification');

const VIDEO_AUDIO_MESSAGE = `
    Uploading large video/audio files directly is not supported. 
    Please convert your media into a **link** using a third-party service (e.g., Imgur for video, Soundcloud for audio) 
    and paste the link into the URL input box to share it easily!
`;



function showPreloader() {
    if (preloader) preloader.classList.remove('hidden');
}

function hidePreloader() {
    if (preloader) preloader.classList.add('hidden');
}

function showNotification(message, type = 'success') {
    if (!notificationContainer || !notificationMessage) return;

    notificationMessage.textContent = message;
    notificationContainer.classList.remove('hidden');
    
    if (type === 'error') {
        notificationContainer.classList.add('error');
    } else if (type === 'loading') { // Za a iya amfani da 'loading' don nuna ci gaba
        notificationContainer.classList.remove('error');
    } else {
        notificationContainer.classList.remove('error');
    }

    setTimeout(() => {
        notificationContainer.classList.add('hidden');
    }, 3000);
}

function showCustomNotification(message, duration = 8000) {
    const notificationDiv = document.createElement('div');
    notificationDiv.className = 'custom-notification-popup';
         
    notificationDiv.innerHTML = `
        <div class="notification-header">
            <h4>ðŸ’¡ Important Notice</h4>
            <button class="close-btn" onclick="this.closest('.custom-notification-popup').remove()" aria-label="Close notification">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="notification-content">
            <p>${message}</p>
            <a href="postVideo.html" class="learn-more-btn">Learn How To Post Video/Audio</a>
        </div>
    `;

    if (customNotificationContainer) {
         customNotificationContainer.appendChild(notificationDiv);
    } else {
        document.body.appendChild(notificationDiv);
    }
    
    setTimeout(() => {
        const popup = notificationDiv;
        if (popup) {
            popup.style.opacity = '0';
            popup.style.transform = 'translateX(100%)';
            setTimeout(() => popup.remove(), 500); 
        }
    }, duration);
}

async function uploadToImgur(file) {
    if (!file.type.startsWith('image/')) {
         showNotification("Invalid file type for Imgur upload.", 'error');
         return null;
    }
    const formData = new FormData();
    formData.append('image', file);

    try {
        const response = await fetch("https://api.imgur.com/3/image", {
            method: "POST",
            headers: {
                Authorization: `Client-ID ${imgurClientId}`
            },
            body: formData
        });

        const data = await response.json();
        if (data.success) {
            return data.data.link;
        } else {
            throw new Error(data.data.error || 'Imgur upload failed');
        }
    } catch (error) {
        showNotification(`Failed to upload image: ${error.message || 'Unknown error'}`, 'error');
        return null;
    }
}


if (uploadProfilePhotoBtn && profilePhotoUploadInput) {
  
    uploadProfilePhotoBtn.addEventListener('click', () => {
        profilePhotoUploadInput.click(); 
    });
   
    profilePhotoUploadInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!currentUser || !file) {
            e.target.value = '';
            return;
        }

        showNotification('Uploading profile picture...');
        const imageUrl = await uploadToImgur(file);
        
        if (imageUrl) {
            const userRef = ref(db, `users/${currentUser.uid}/profilePhoto`);
            await set(userRef, imageUrl);
            showNotification('Profile picture updated!');
           
            const postsRef = ref(db, `users/${currentUser.uid}/Posting`);
            const snapshot = await get(postsRef);
            const posts = snapshot.val();
            if (posts) {
                const updates = {};
                for (const postId in posts) {
                    updates[`users/${currentUser.uid}/Posting/${postId}/profilePhoto`] = imageUrl;
                }
                await update(ref(db), updates);
            }
        } else {
            showNotification('Failed to upload picture. Try again.', 'error');
        }
        e.target.value = '';
    });
}



if (uploadImageBtn && postImageUploadInput) {
    uploadImageBtn.addEventListener('click', () => {
        postImageUploadInput.click(); 
    });

    postImageUploadInput.addEventListener('change', (e) => {
        const files = Array.from(e.target.files).filter(file => file.type.startsWith('image/')).slice(0, 4);        
       
        files.forEach(file => {
            if (selectedPostFiles.length < 4) { 
                selectedPostFiles.push(file);
            }
        });
        siteRenderSelectedImages();
        e.target.value = ''; 
    });
}


function siteRenderSelectedImages() {
    if (!selectedImagesPreview) return;
    selectedImagesPreview.innerHTML = '';
    selectedPostFiles.forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'image-preview-item';
            itemDiv.dataset.index = index;
            itemDiv.innerHTML = `
                <img src="${e.target.result}" alt="Preview Image">
                <button class="remove-image-btn" data-index="${index}"><i class="fas fa-times"></i></button>
            `;
            selectedImagesPreview.appendChild(itemDiv);
             itemDiv.querySelector('.remove-image-btn').addEventListener('click', (event) => {
                const fileIndex = parseInt(event.currentTarget.dataset.index);
                selectedPostFiles.splice(fileIndex, 1); // Cire file daga array
                siteRenderSelectedImages(); 
            });
        };
        reader.readAsDataURL(file);
    });
}


if (uploadVideoBtn) {
    uploadVideoBtn.addEventListener('click', () => {
        showCustomNotification(VIDEO_AUDIO_MESSAGE);
    });
}
if (uploadAudioBtn) {
    uploadAudioBtn.addEventListener('click', () => {
        showCustomNotification(VIDEO_AUDIO_MESSAGE);
    });
}



if (submitPostBtn) {
    submitPostBtn.addEventListener('click', siteSubmitPost);
}

async function siteSubmitPost() {
    if (!currentUser) {
        showNotification('Please log in to create a post.');
        return;
    }

    showNotification('Processing post and uploading images...');
    submitPostBtn.disabled = true;

    let uploadedImageLinks = [];
  
    if (selectedPostFiles.length > 0) {
        showNotification(`Uploading ${selectedPostFiles.length} image(s)...`, 'loading');
        for (const file of selectedPostFiles) {
            const url = await uploadToImgur(file); 
            if (url) {
                uploadedImageLinks.push(url);
            } else {
                showNotification(`Warning: Failed to upload one image file.`, 'error');
            }
        }
    }
    
    const manualImageLinks = imageLinkInput && imageLinkInput.value.split(',').map(link => link.trim()).filter(link => link) || [];
    uploadedImageLinks = uploadedImageLinks.concat(manualImageLinks);
  
    if ((!postTextarea || postTextarea.value.trim() === '') && uploadedImageLinks.length === 0 && (!videoLinkInput || videoLinkInput.value.trim() === '') && (!audioLinkInput || audioLinkInput.value.trim() === '')) {
         showNotification('Post cannot be empty.', 'error');
         submitPostBtn.disabled = false;
         return;
    }

    const postData = {
        userId: currentUser.uid,
        text: (postTextarea && postTextarea.value) || '',
        photoLink1: uploadedImageLinks.join(',') || '', 
        videoLink: (videoLinkInput && videoLinkInput.value) || '',
        audioLink: (audioLinkInput && audioLinkInput.value) || '',
        postingTime: new Date().toISOString(),
        location: 'Nigeria, FCT',
        see: 0,
        like: 0,
        totalComment: 0,
        profilePhoto: (profileDataCache && profileDataCache.profilePhoto) || 'https://i.imgur.com/lwddsvh.png',
        fullName: (profileDataCache && profileDataCache.fullName) || 'User',
        country: (profileDataCache && profileDataCache.country) || '',
        state: (profileDataCache && profileDataCache.state) || '',
        position: (profileDataCache && profileDataCache.position) || '',
        profileLink: (profileDataCache && profileDataCache.profileLink) || '',
    };

    try {
        const postsRef = ref(db, `users/${currentUser.uid}/Posting`);
        const newPostRef = push(postsRef);
        await set(newPostRef, postData);
        
        showNotification('Post created successfully!', 'success');
        if (writePostContainer) writePostContainer.classList.add('hidden');
        
        // Clearing inputs and state
        if (postTextarea) postTextarea.value = '';
        if (imageLinkInput) imageLinkInput.value = '';
        if (videoLinkInput) videoLinkInput.value = '';
        if (audioLinkInput) audioLinkInput.value = '';
        selectedPostFiles = []; 
        siteRenderSelectedImages(); 
    } catch (error) {
        showNotification('Failed to create post. Please try again.', 'error');
    } finally {
        submitPostBtn.disabled = false;
    }
}


onAuthStateChanged(auth, async (user) => {
    
    const urlParams = new URLSearchParams(window.location.search);
    const profileUid = urlParams.get('uid') || (user ? user.uid : null);

    if (user) {
        currentUser = user;
    } else {
        currentUser = null;
    }

    if (profileUid) {
       
        await siteLoadProfileAndPosts(profileUid); 
        
    } else {
        if (document.querySelector('.profile-banner')) document.querySelector('.profile-banner').classList.add('no-uid-profile');
        if (profilePhoto) profilePhoto.src = "https://i.imgur.com/lwddsvh.png";
        if (shareProfileBtn) shareProfileBtn.classList.add('hidden');
        if (newPostBtn) newPostBtn.classList.add('hidden');
        if (coursesLink) coursesLink.classList.add('hidden');
        if (notesLink) notesLink.classList.add('hidden');
        if (postsContainer) postsContainer.innerHTML = '<p class="public-message" style="text-align: center;">This is a public profile. Please view here before clicking <a href="index.html">Home</a> </p>';
    }     
    hidePreloader(); 
});


async function siteLoadProfileAndPosts(uid) {
    return new Promise((resolve) => {
        const userRef = ref(db, `users/${uid}`);
      
        get(userRef).then(snapshot => {
            const userData = snapshot.val();
            if (userData) {
                profileDataCache = userData;
                siteUpdateProfileUI(uid, userData);
                siteDisplayUserInfo(userData);
            }
                       
            onValue(userRef, (snapshot) => {
                const updatedData = snapshot.val();
                if (updatedData) {
                    profileDataCache = updatedData;
                    siteUpdateProfileUI(uid, updatedData);
                    siteDisplayUserInfo(updatedData);
                }
            });

            const postsRef = ref(db, `users/${uid}/Posting`);
            onValue(postsRef, (snapshot) => {
                const posts = snapshot.val();
                postsDataCache = posts || {};
                siteRenderPosts(uid, postsDataCache);
              
                resolve(); 
            });

        }).catch(error => {
            console.error("Error loading initial data:", error);
            resolve();
        });
    });
}

function siteDisplayUserInfo(userData) {
    if (!userFullName || !userPosition || !userLocation) return;
    userFullName.textContent = userData.fullName || 'No name provided';
    userPosition.textContent = userData.position || 'No position';
    userLocation.textContent = `${userData.country || 'Unknown country'}, ${userData.state || 'Unknown state'}`;
}

function siteUpdateProfileUI(uid, userData) {
    if (!profilePhoto || !uploadProfilePhotoBtn || !shareProfileBtn || !newPostBtn || !coursesLink || !notesLink) return;
    
    if (userData.profilePhoto) {
        profilePhoto.src = userData.profilePhoto;
    }
    const isOwner = currentUser && currentUser.uid === uid;
    
    if (isOwner) {
        uploadProfilePhotoBtn.classList.remove('hidden'); 
        shareProfileBtn.classList.remove('hidden');
        newPostBtn.classList.remove('hidden');
        coursesLink.classList.remove('hidden');
        notesLink.classList.remove('hidden');
    } else {
        uploadProfilePhotoBtn.classList.add('hidden'); 
        shareProfileBtn.classList.remove('hidden');
        newPostBtn.classList.add('hidden');
        coursesLink.classList.add('hidden');
        notesLink.classList.add('hidden');
    }
    profilePhoto.onclick = () => viewProfileImage(profilePhoto.src);
}


if (imageViewerProfileClose) {
    imageViewerProfileClose.addEventListener('click', () => {
        if (imageViewerProfile) imageViewerProfile.classList.add('hidden');
    });
}
if (imageViewerClose) {
    imageViewerClose.addEventListener('click', () => {
        if (imageViewer) imageViewer.classList.add('hidden');
    });
}
if (videoViewerClose) {
    videoViewerClose.addEventListener('click', () => {
        if (viewerVideo) viewerVideo.pause();
        if (videoViewer) videoViewer.classList.add('hidden');
    });
}


if (postsContainer) {
    postsContainer.addEventListener('click', handlePostActions);
}


if (newPostBtn) {
    newPostBtn.addEventListener('click', () => {
        if (writePostContainer) writePostContainer.classList.remove('hidden');
    });
}

if (closePostBtn) {
    closePostBtn.addEventListener('click', () => {
        if (writePostContainer) writePostContainer.classList.add('hidden');
        if (postTextarea) postTextarea.value = '';
        if (imageLinkInput) imageLinkInput.value = '';
        if (videoLinkInput) videoLinkInput.value = '';
        if (audioLinkInput) audioLinkInput.value = '';
    });
}

if (linkInputBtn) {
    linkInputBtn.addEventListener('click', () => {
        if (linkInputContainer) linkInputContainer.classList.toggle('hidden');
       
    });
}

if (linkInputCloseBtn) {
    linkInputCloseBtn.addEventListener('click', () => {
        if (linkInputContainer) linkInputContainer.classList.add('hidden');
    });
}

document.addEventListener('click', (event) => {
    document.querySelectorAll('.post-options-menu').forEach(menu => {
        const postDiv = menu.closest('.post-card');
        const optionsBtn = postDiv ? postDiv.querySelector('.post-options-btn') : null;
        if (optionsBtn && !optionsBtn.contains(event.target) && !menu.contains(event.target)) {
            menu.classList.add('hidden');
            const otherLangContainer = menu.querySelector('.other-lang-container');
            if (otherLangContainer) {
                otherLangContainer.classList.add('hidden');
            }
        }
    });
});


const observerOptions = {
    root: null,
    rootMargin: '0px',
    threshold: 0.5 
};
const postObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const postDiv = entry.target;
            const postId = postDiv.dataset.postId;
            const ownerUid = postDiv.dataset.ownerUid;
            handlePostSee(ownerUid, postId);
            observer.unobserve(postDiv);
        }
    });
}, observerOptions);



function formatTimeAgo(timestamp) {
    if (!timestamp) return '';
    const now = new Date();
    const postDate = new Date(timestamp);
    if (isNaN(postDate.getTime())) {
        return '';
    }
    const seconds = Math.floor((now - postDate) / 1000);
    let interval = seconds / 31536000;
    if (interval > 1) return Math.floor(interval) + " years ago";
    interval = seconds / 2592000;
    if (interval > 1) return Math.floor(interval) + " months ago";
    interval = seconds / 86400;
    if (interval > 1) return Math.floor(interval) + " days ago";
    interval = seconds / 3600;
    if (interval > 1) return Math.floor(interval) + " hours ago";
    interval = seconds / 60;
    if (interval > 1) return Math.floor(interval) + " minutes ago";
    return Math.floor(seconds) + " seconds ago";
}

function showLoading(element) {
    element.innerHTML = '<span class="loading-spinner"></span>';
    element.classList.add('loading-text-container');
}

function hideLoading(element, translatedText) {
    element.textContent = translatedText;
    element.classList.remove('loading-text-container');
}

function viewImage(imageSrc) {
    if (!viewerImage || !imageViewer) return;
    viewerImage.src = imageSrc;
    imageViewer.classList.remove('hidden');
}

function viewVideo(videoSrc) {
    if (!viewerVideo || !videoViewer) return;
    viewerVideo.src = videoSrc;
    viewerVideo.load();
    viewerVideo.play();
    videoViewer.classList.remove('hidden');
}

function viewProfileImage(profileSrc, badgeSrc) {
    if (!viewerProfileImage || !imageViewerProfile || !viewerProfileBadge) return;
    viewerProfileImage.src = profileSrc;
    if (badgeSrc) {
        viewerProfileBadge.src = badgeSrc;
        viewerProfileBadge.classList.remove('hidden');
    } else {
        viewerProfileBadge.classList.add('hidden');
    }
    imageViewerProfile.classList.remove('hidden');
}

function getGuestUserId() {
    let guestId = localStorage.getItem('guestUserId');
    if (!guestId) {
        guestId = 'guest-' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('guestUserId', guestId);
    }
    return guestId;
}

async function handlePostLike(ownerUid, postId) {
    const userId = (currentUser) ? currentUser.uid : getGuestUserId();
    const likedKey = `liked-${postId}-${userId}`;
    const likeRef = ref(db, `users/${ownerUid}/Posting/${postId}/like`);
    try {
        const hasLiked = localStorage.getItem(likedKey) === 'true';
        if (hasLiked) {
            localStorage.setItem(likedKey, 'false');
            await runTransaction(likeRef, (currentLike) => {
                return Math.max(0, (currentLike || 1) - 1);
            });
        } else {
            localStorage.setItem(likedKey, 'true');
            await runTransaction(likeRef, (currentLike) => {
                return (currentLike || 0) + 1;
            });
        }
    } catch (error) {
        console.error("Kuskure wajen canza son post (like):", error);
    }
}

async function handlePostSee(ownerUid, postId) {
    const userId = (currentUser) ? currentUser.uid : getGuestUserId(); 
    const hasSeenKey = `seen-${postId}-${userId}`;

    if (localStorage.getItem(hasSeenKey)) {
        return; 
    }

    const seeRef = ref(db, `users/${ownerUid}/Posting/${postId}/see`);
    try {
        await runTransaction(seeRef, (currentSee) => {
            return (currentSee || 0) + 1;
        });
        localStorage.setItem(hasSeenKey, 'true');
    } catch (error) {
        console.error("Error updating see count:", error);
    }
}

async function deletePostWithNotification(ownerUid, postId) {
    showNotification('Deleting post...');
    const postRef = ref(db, `users/${ownerUid}/Posting/${postId}`);
    try {
        await remove(postRef);
        showNotification('Post deleted!');
    } catch (error) {
        showNotification('Failed to delete post.');
    }
}

async function translatePostText(element, originalText, targetLang, postId) {
    const localStorageKey = `translation-${postId}-${targetLang}`; 
    const postDiv = element.closest('.post-card');
    const readMoreBtn = postDiv ? postDiv.querySelector('.read-more-btn') : null;
    
    delete element.dataset.fullTranslatedText;
    const cachedTranslation = localStorage.getItem(localStorageKey);
    
    if (cachedTranslation) {
        const needsTruncate = cachedTranslation.length > TRUNCATE_LIMIT;
        
        if (needsTruncate) {
            element.textContent = cachedTranslation.substring(0, TRUNCATE_LIMIT) + '...';
            element.dataset.fullTranslatedText = cachedTranslation;
            if (readMoreBtn) readMoreBtn.classList.remove('hidden');
        } else {
            element.textContent = cachedTranslation;
            if (readMoreBtn) readMoreBtn.classList.add('hidden');
        }
        
        showNotification(`Using cached translation to ${targetLang}.`);
        return;
    }
    
    showLoading(element);
    
    try {
        const response = await fetch("https://leadwaypeace.pages.dev/api/translate", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "x-api-key": "@haruna66"
            },
            body: JSON.stringify({
                text: originalText,
                targetLang: targetLang
            })
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            
            const originalNeedsTruncate = originalText.length > TRUNCATE_LIMIT;
            hideLoading(element, originalNeedsTruncate ? originalText.substring(0, TRUNCATE_LIMIT) + '...' : originalText); 
            if (readMoreBtn) {
                if(originalNeedsTruncate) {
                    readMoreBtn.classList.remove('hidden');
                } else {
                    readMoreBtn.classList.add('hidden');
                }
            }
            showNotification(`Translation failed: ${errorData.message || 'Server error'}`, 'error');
            return;
        }
        
        const translatedData = await response.json();
        const translatedText = translatedData.translation || originalText;
        
        localStorage.setItem(localStorageKey, translatedText);
        
        const needsTruncate = translatedText.length > TRUNCATE_LIMIT;
        let textToDisplay = translatedText;
        
        if (needsTruncate) {
            textToDisplay = translatedText.substring(0, TRUNCATE_LIMIT) + '...';
            element.dataset.fullTranslatedText = translatedText;
            if (readMoreBtn) readMoreBtn.classList.remove('hidden');
        } else {
            if (readMoreBtn) readMoreBtn.classList.add('hidden');
        }
        hideLoading(element, textToDisplay);
        showNotification('Translation successful!');
        
    } catch (error) {
        
        const originalNeedsTruncate = originalText.length > TRUNCATE_LIMIT;
        hideLoading(element, originalNeedsTruncate ? originalText.substring(0, TRUNCATE_LIMIT) + '...' : originalText); 
        if (readMoreBtn) {
            if(originalNeedsTruncate) {
                readMoreBtn.classList.remove('hidden');
            } else {
                readMoreBtn.classList.add('hidden');
            }
        }
        showNotification('Failed to translate. Showing original text.', 'error');
    }
}

async function editPost(ownerUid, postId) {
    if (!editPostTextarea || !editPostModal || !editPostSaveBtn || !editPostCancelBtn) return;

    const post = postsDataCache[postId];
    editPostTextarea.value = post.text;
    editPostModal.classList.remove('hidden');

    const savePostHandler = async () => {
        const newText = editPostTextarea.value;
        if (newText !== null && newText !== post.text) {
            showNotification('Updating post...');
            const postRef = ref(db, `users/${ownerUid}/Posting/${postId}/text`);
            try {
                await set(postRef, newText);
                showNotification('Post updated!');
                editPostModal.classList.add('hidden');
            } catch (error) {
                showNotification('Failed to update post.');
            }
        } else {
            editPostModal.classList.add('hidden');
        }
        editPostSaveBtn.removeEventListener('click', savePostHandler);
        editPostCancelBtn.removeEventListener('click', cancelPostHandler);
        if(editPostCloseBtn) editPostCloseBtn.removeEventListener('click', cancelPostHandler);
    };

    const cancelPostHandler = () => {
        editPostModal.classList.add('hidden');
        editPostSaveBtn.removeEventListener('click', savePostHandler);
        editPostCancelBtn.removeEventListener('click', cancelPostHandler);
        if(editPostCloseBtn) editPostCloseBtn.removeEventListener('click', cancelPostHandler);
    };

    editPostSaveBtn.addEventListener('click', savePostHandler);
    editPostCancelBtn.addEventListener('click', cancelPostHandler);
    if(editPostCloseBtn) editPostCloseBtn.addEventListener('click', cancelPostHandler);
}

function handlePostActions(event) {
    const target = event.target;
    const postDiv = target.closest('.post-card');
    if (!postDiv) return;

    const postId = postDiv.dataset.postId;
    const ownerUid = postDiv.dataset.ownerUid;
    const postTextElement = postDiv.querySelector(`#post-text-${postId}`);
    const originalText = postsDataCache[postId] ? postsDataCache[postId].text : '';
    const isOwner = currentUser && currentUser.uid === ownerUid;

    if (target.classList.contains('read-more-btn')) {
        const translatedText = postTextElement.dataset.fullTranslatedText;
        
        if (translatedText) {
            postTextElement.textContent = translatedText;
        } else {
            postTextElement.textContent = originalText;
        }
        
        target.classList.add('hidden');
        return;
    }

    const clickedMedia = target.closest('.post-media-container img, .post-media-container video, .post-media-container .video-overlay');
    if (clickedMedia) {
        if (clickedMedia.tagName === 'IMG') {
            viewImage(clickedMedia.src);
        } else if (clickedMedia.tagName === 'VIDEO' || clickedMedia.classList.contains('video-overlay')) {
            const videoElement = postDiv.querySelector('video');
            if (videoElement) {
                viewVideo(videoElement.src);
            }
        }
        return;
    }

    const clickedProfilePhoto = target.closest('.post-user-info .profile-photo');
    if (clickedProfilePhoto) {
        const post = postsDataCache[postId];
        viewProfileImage(clickedProfilePhoto.src, post ? post.supportTeams : null);
        return;
    }

    const likeBtn = target.closest('.like-count');
    if (likeBtn) {
        if (postId && ownerUid) {
            handlePostLike(ownerUid, postId);
        }
        return;
    }

    const commentBtn = target.closest('.comment-count');
    if (commentBtn) {
        if (postId && ownerUid) {
            window.location.href = `comment.html?postId=${postId}&postUid=${ownerUid}`;
        }
        return;
    }

    const optionsBtn = target.closest('.post-options-btn');
    if (optionsBtn) {
        const optionsMenu = postDiv.querySelector(`#options-menu-${postId}`);
        document.querySelectorAll('.post-options-menu:not(.hidden)').forEach(menu => {
            if (menu !== optionsMenu) {
                menu.classList.add('hidden');
                const otherLangContainer = menu.querySelector('.other-lang-container');
                if(otherLangContainer) otherLangContainer.classList.add('hidden');
            }
        });
        if (optionsMenu) optionsMenu.classList.toggle('hidden');
        return;
    }

    const closeOptionsBtn = target.closest('.close-options-menu');
    if (closeOptionsBtn) {
        closeOptionsBtn.closest('.post-options-menu').classList.add('hidden');
        return;
    }

    const actionBtn = target.closest('button[data-action]');
    if (actionBtn) {
        const action = actionBtn.dataset.action;
        const menu = actionBtn.closest('.post-options-menu');
        const otherLangContainer = menu ? menu.querySelector('.other-lang-container') : null;

        if (action === 'delete' && isOwner) {
            deletePostWithNotification(ownerUid, postId);
        } else if (action === 'translate-other') {
            if (otherLangContainer) {
                otherLangContainer.classList.remove('hidden');
            }
        } else if (action === 'translate-other-confirm') {
            const otherLangInput = document.getElementById(`other-lang-input-${postId}`);
            const targetLang = otherLangInput ? otherLangInput.value.trim() : '';
            if (targetLang) {
                translatePostText(postTextElement, originalText, targetLang, postId);
            } else {
                showNotification('Please enter a language.', 'error');
            }
            if (menu) menu.classList.add('hidden');
            if(otherLangContainer) otherLangContainer.classList.add('hidden');
        } else if (action && action.startsWith('translate-')) {
            const targetLang = action.replace('translate-', '');
            if (postTextElement) {
                translatePostText(postTextElement, originalText, targetLang, postId);
            }
            if (menu) menu.classList.add('hidden');
            if(otherLangContainer) otherLangContainer.classList.add('hidden');
        } else if (action === 'edit' && isOwner) {
            editPost(ownerUid, postId);
            if (menu) menu.classList.add('hidden');
        }
    }
}


function siteRenderPosts(uid, posts) {
    if (!postsContainer) return;
    postsContainer.innerHTML = '';
    const postIds = Object.keys(posts || {});
    postIds.sort((a, b) => new Date(posts[b].postingTime) - new Date(posts[a].postingTime));
    const fragment = document.createDocumentFragment();

    postIds.forEach(postId => {
        const post = posts[postId];
        const postElement = siteCreatePostElement(uid, postId, post);
        fragment.appendChild(postElement);
    });

    postsContainer.appendChild(fragment);

    postsContainer.querySelectorAll('.post-card').forEach(postElement => {
        postObserver.observe(postElement);
    });
}

function siteCreatePostElement(ownerUid, postId, post) {
    const postDiv = document.createElement('div');
    postDiv.className = 'post-card';
    postDiv.dataset.postId = postId;
    postDiv.dataset.ownerUid = ownerUid;
    const isOwner = currentUser && currentUser.uid === ownerUid;
    const hasText = post.text && post.text.trim() !== '';
    const needsTruncate = hasText && post.text.length > TRUNCATE_LIMIT;
    const displayText = needsTruncate ? post.text.substring(0, TRUNCATE_LIMIT) + '...' : post.text;
    
    let mediaHTML = '';
    
    if (post.photoLink1) {
        const photoLinks = post.photoLink1.split(',').map(link => link.trim()).filter(link => link);
        photoLinks.forEach(link => {
             mediaHTML += `<img src="${link}" alt="Post Photo">`;
        });
    }
    if (post.videoLink) {
        mediaHTML += `<video src="${post.videoLink}" controls></video>`;
    }
    if (post.audioLink) {
        mediaHTML += `<audio src="${post.audioLink}" controls></audio>`;
    }
    
    postDiv.innerHTML = `
        <div class="post-header">
            <div class="post-user-info">
                <img src="${post.profilePhoto || 'https://i.imgur.com/lwddsvh.png'}" alt="Profile Photo" class="profile-photo">
                <div class="user-details">
                    <h4><i class=""></i> ${post.fullName || 'User'} ${post.position ? `(${post.position})` : ''}</h4>
                    <span class="user-meta">${post.country || ''}, ${post.state || ''} &bull; ${formatTimeAgo(post.postingTime)}</span>
                </div>
            </div>
            <div class="post-options-container">
                <button class="post-options-btn" aria-label="Post Options">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
                <div class="post-options-menu hidden" id="options-menu-${postId}">
                    <button class="close-options-menu" aria-label="Close menu"><i class="fas fa-times"></i></button>
                    ${hasText ? `<button data-action="translate-en">English</button>` : ''}
                    ${hasText ? `<button data-action="translate-ha">Hausa</button>` : ''}
                    ${hasText ? `<button data-action="translate-yo">Yoruba</button>` : ''}
                    ${hasText ? `<button data-action="translate-ig">Igbo</button>` : ''}
                    ${hasText ? `<button data-action="translate-fr">French</button>` : ''}
                    ${hasText ? `<button data-action="translate-ar">Arabic</button>` : ''}
                    ${hasText ? `<button data-action="translate-other">Other...</button>` : ''}
                    <div class="other-lang-container hidden">
                        <input type="text" id="other-lang-input-${postId}" placeholder="Enter language name (e.g., Spanish)">
                        <button data-action="translate-other-confirm" data-post-id="${postId}">Translate</button>
                    </div>
                    ${isOwner ? `<button data-action="edit">Edit</button>` : ''}
                    ${isOwner ? `<button data-action="delete">Delete</button>` : ''}
                </div>
            </div>
        </div>
        <div class="post-content">
            ${hasText ? `<p class="post-text" id="post-text-${postId}">${displayText}</p>` : ''}
            ${needsTruncate ? `<button class="read-more-btn">Read More</button>` : ''}
            <div class="post-media-container" id="media-container-${postId}">
                ${mediaHTML}
            </div>
        </div>
        <div class="post-footer">
            <div class="post-footer-item see-count">
                <i class="fas fa-eye"></i> <span id="see-count-${postId}">${post.see || 0}</span>
            </div>
            <div class="post-footer-item comment-count" data-post-id="${postId}" data-post-uid="${ownerUid}">
                <i class="fas fa-comment"></i> <span id="comment-count-${postId}">${post.totalComment || 0}</span>
            </div>
            <div class="post-footer-item like-count" data-post-id="${postId}" data-post-uid="${ownerUid}">
                <i class="fas fa-thumbs-up"></i> <span id="like-count-${postId}">${post.like || 0}</span>
            </div>
        </div>
    `;
    return postDiv;
}
                              
    
</script>
    </body>
</html>
